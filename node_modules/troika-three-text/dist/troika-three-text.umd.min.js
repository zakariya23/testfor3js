/*
 Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
  Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
 Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
  (https://github.com/101arrowz/fflate) for use in Troika text rendering. 
  Original licenses apply: 
  - fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
  - woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
 Custom bundle of @unicode-font-resolver/client v1.0.0 (https://github.com/lojjic/unicode-font-resolver)
  for use in Troika text rendering. 
  Original MIT license applies
*/
'use strict';(function(E,B){"object"===typeof exports&&"undefined"!==typeof module?B(exports,require("three"),require("troika-worker-utils"),require("webgl-sdf-generator"),require("bidi-js"),require("troika-three-utils")):"function"===typeof define&&define.amd?define("exports three troika-worker-utils webgl-sdf-generator bidi-js troika-three-utils".split(" "),B):(E="undefined"!==typeof globalThis?globalThis:E||self,B(E.troika_three_text={},E.THREE,E.troika_worker_utils,E.webgl_sdf_generator,E.bidi_js,
E.troika_three_utils))})(this,function(E,B,S,aa,P,sa){function ta(g){return g&&"object"===typeof g&&"default"in g?g:{"default":g}}function Pa(g,f,k,m,b,a,c,d,e,h,l=!0){return l?Qa(g,f,k,m,b,a,c,d,e,h).then(null,l=>{ua||(console.warn("WebGL SDF generation failed, falling back to JS",l),ua=!0);return va(g,f,k,m,b,a,c,d,e,h)}):va(g,f,k,m,b,a,c,d,e,h)}function wa(){let g=Q();for(;ha.length&&5>Q()-g;)ha.shift()();ma=ha.length?setTimeout(wa,0):0}function va(g,f,k,m,b,a,c,d,e,h){let l="TroikaTextSDFGenerator_JS_"+
Ra++%4,n=xa[l];n||(n=xa[l]={workerModule:S.defineWorkerModule({name:l,workerId:l,dependencies:[ya["default"],Q],init(a,b){let c=a().javascript.generate;return function(...a){let d=b();return{textureData:c(...a),timing:b()-d}}},getTransferables(a){return[a.textureData.buffer]}}),requests:0,idleTimer:null});n.requests++;clearTimeout(n.idleTimer);return n.workerModule(g,f,k,m,b,a).then(({textureData:a,timing:b})=>{let F=Q(),k=new Uint8Array(4*a.length);for(let b=0;b<a.length;b++)k[4*b+h]=a[b];ia.webglUtils.renderImageData(c,
k,d,e,g,f,1<<3-h);b+=Q()-F;0===--n.requests&&(n.idleTimer=setTimeout(()=>{S.terminateWorker(l)},2E3));return{timing:b}})}function W(){return(self.performance||Date).now()}function na(g,f){za=!0;g=Aa({},g);let k=W();var {defaultFontURL:m}=X,b=[];m&&b.push({label:"default",src:Ba(m)});g.font&&b.push({label:"user",src:Ba(g.font)});g.font=b;g.text=""+g.text;g.sdfGlyphSize=g.sdfGlyphSize||X.sdfGlyphSize;g.unicodeFontsURL=g.unicodeFontsURL||X.unicodeFontsURL;if(null!=g.colorRanges){m={};for(var a in g.colorRanges)g.colorRanges.hasOwnProperty(a)&&
(b=g.colorRanges[a],"number"!==typeof b&&(b=Sa.set(b).getHex()),m[a]=b);g.colorRanges=m}Object.freeze(g);let {textureWidth:c,sdfExponent:d}=X,{sdfGlyphSize:e}=g,h=c/e*4,l=ja[e];l||(a=document.createElement("canvas"),a.width=c,a.height=256*e/h,l=ja[e]={glyphCount:0,sdfGlyphSize:e,sdfCanvas:a,sdfTexture:new B.Texture(a,void 0,void 0,void 0,B.LinearFilter,B.LinearFilter),contextLost:!1,glyphsByFont:new Map},l.sdfTexture.generateMipmaps=!1,Ta(l));let {sdfTexture:n,sdfCanvas:F}=l;Ua(g).then(a=>{let {glyphIds:b,
glyphFontIndices:m,fontData:w,glyphPositions:r,fontSize:u,timings:t}=a,v=[],G=new Float32Array(4*b.length),y=0,C=0;var H=W();let L=w.map(a=>{let b=l.glyphsByFont.get(a.src);b||l.glyphsByFont.set(a.src,b=new Map);return b});b.forEach((c,d)=>{var f=m[d];let {src:h,unitsPerEm:n}=w[f];var g=L[f].get(c);if(!g){let {path:b,pathBounds:d}=a.glyphData[h][c];g=Math.max(d[2]-d[0],d[3]-d[1])/e*(X.sdfMargin*e+.5);var F=l.glyphCount++;L[f].set(c,g={path:b,atlasIndex:F,sdfViewBox:[d[0]-g,d[1]-g,d[2]+g,d[3]+g]});
v.push(g)}({sdfViewBox:c}=g);f=r[C++];F=r[C++];let k=u/n;G[y++]=f+c[0]*k;G[y++]=F+c[1]*k;G[y++]=f+c[2]*k;G[y++]=F+c[3]*k;b[d]=g.atlasIndex});t.quads=(t.quads||0)+(W()-H);let J=W();t.sdf={};H=F.height;let Y=Math.pow(2,Math.ceil(Math.log2(Math.ceil(l.glyphCount/h)*e)));Y>H&&(console.info(`Increasing SDF texture size ${H}->${Y}`),Va(F,c,Y),n.dispose());Promise.all(v.map(a=>Ca(a,l,g.gpuAccelerateSDF).then(({timing:b})=>{t.sdf[a.atlasIndex]=b}))).then(()=>{v.length&&!l.contextLost&&(Da(l),n.needsUpdate=
!0);t.sdfTotal=W()-J;t.total=W()-k;f(Object.freeze({parameters:g,sdfTexture:n,sdfGlyphSize:e,sdfExponent:d,glyphBounds:G,glyphAtlasIndices:b,glyphColors:a.glyphColors,caretPositions:a.caretPositions,chunkedBounds:a.chunkedBounds,ascender:a.ascender,descender:a.descender,lineHeight:a.lineHeight,capHeight:a.capHeight,xHeight:a.xHeight,topBaseline:a.topBaseline,blockBounds:a.blockBounds,visibleBounds:a.visibleBounds,timings:a.timings}))})});Promise.resolve().then(()=>{l.contextLost||F._warm||(ia.webgl.isSupported(F),
F._warm=!0)})}function Ca({path:g,atlasIndex:f,sdfViewBox:k},{sdfGlyphSize:m,sdfCanvas:b,contextLost:a},c){if(a)return Promise.resolve({timing:-1});let {textureWidth:d,sdfExponent:e}=X;a=Math.floor(f/4);return Pa(m,m,g,k,Math.max(k[2]-k[0],k[3]-k[1]),e,b,a%(d/m)*m,Math.floor(a/(d/m))*m,f%4,c)}function Ta(g){let f=g.sdfCanvas;f.addEventListener("webglcontextlost",f=>{console.log("Context Lost",f);f.preventDefault();g.contextLost=!0});f.addEventListener("webglcontextrestored",f=>{console.log("Context Restored",
f);g.contextLost=!1;let k=[];g.glyphsByFont.forEach(b=>{b.forEach(a=>{k.push(Ca(a,g,!0))})});Promise.all(k).then(()=>{Da(g);g.sdfTexture.needsUpdate=!0})})}function Aa(g,f){for(let k in f)f.hasOwnProperty(k)&&(g[k]=f[k]);return g}function Ba(g){ka||(ka="undefined"===typeof document?{}:document.createElement("a"));ka.href=g;return ka.href}function Da(g){if("function"!==typeof createImageBitmap){console.info("Safari<15: applying SDF canvas workaround");let {sdfCanvas:f,sdfTexture:k}=g,{width:m,height:b}=
f;g=g.sdfCanvas.getContext("webgl");let a=k.image.data;a&&a.length===m*b*4||(a=new Uint8Array(m*b*4),k.image={width:m,height:b,data:a},k.flipY=!1,k.isDataTexture=!0);g.readPixels(0,0,m,b,g.RGBA,g.UNSIGNED_BYTE,a)}}function Wa(g){var f=Ea[g];if(!f){f=new B.PlaneGeometry(1,1,g,g);let k=f.clone(),m=f.attributes,b=k.attributes,a=new B.BufferGeometry,c=m.uv.count;for(let a=0;a<c;a++)b.position.array[3*a]*=-1,b.normal.array[3*a+2]*=-1;["position","normal","uv"].forEach(c=>{a.setAttribute(c,new B.Float32BufferAttribute([...m[c].array,
...b[c].array],m[c].itemSize))});a.setIndex([...f.index.array,...k.index.array.map(a=>a+c)]);a.translate(.5,.5,0);f=Ea[g]=a}return f}function oa(g,f,k,m){let b=g.getAttribute(f);k?b&&b.array.length===k.length?(b.array.set(k),b.needsUpdate=!0):(g.setAttribute(f,new B.InstancedBufferAttribute(k,m)),delete g._maxInstanceCount,g.dispose()):b&&g.deleteAttribute(f)}function Fa(g){g=sa.createDerivedMaterial(g,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new B.Vector2},
uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new B.Vector4(0,0,0,0)},uTroikaClipRect:{value:new B.Vector4(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new B.Vector2},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new B.Color},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new B.Matrix3},uTroikaUseGlyphColors:{value:!0},
uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",
vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",
fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaOutlineOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of exponential encoding in webgl-sdf-generator\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",
fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat fragDistance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  fragDistance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",
customRewriter({vertexShader:f,fragmentShader:g}){let k=/\buniform\s+vec3\s+diffuse\b/;k.test(g)&&(g=g.replace(k,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),k.test(f)||(f=f.replace(sa.voidMainRegExp,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n")));return{vertexShader:f,fragmentShader:g}}});g.transparent=!0;Object.defineProperties(g,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},
set(){}}});return g}function Ga(g){return Array.isArray(g)?g[0]:g}function Xa(g){let f=Ha.get(g);if(!f){f=[];let {caretPositions:k}=g,m,b=(a,b,e,h)=>{(!m||e<(m.top+m.bottom)/2)&&f.push(m={bottom:b,top:e,carets:[]});e>m.top&&(m.top=e);b<m.bottom&&(m.bottom=b);m.carets.push({x:a,y:b,height:e-b,charIndex:h})},a=0;for(;a<k.length;a+=4)b(k[a],k[a+2],k[a+3],a/4);b(k[a-3],k[a-2],k[a-1],a/4)}Ha.set(g,f);return f}var ya=ta(aa);P=ta(P);aa=S.defineWorkerModule({name:"Typr Font Parser",dependencies:[function(){return"undefined"==
typeof window&&(self.window=self),function(g){var f={parse:function(b){var a=f._bin;b=new Uint8Array(b);if("ttcf"==a.readASCII(b,0,4)){var c=4;a.readUshort(b,c);c+=2;a.readUshort(b,c);c+=2;var d=a.readUint(b,c);c+=4;for(var e=[],h=0;h<d;h++){var l=a.readUint(b,c);c+=4;e.push(f._readFont(b,l))}return e}return[f._readFont(b,0)]},_readFont:function(b,a){var c=f._bin,d=a;c.readFixed(b,a);a+=4;var e=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;var h="cmap;head;hhea;maxp;hmtx;name;OS/2;post;loca;glyf;kern;CFF ;GPOS;GSUB;SVG ".split(";");
d={_data:b,_offset:d};for(var l={},n=0;n<e;n++){var g=c.readASCII(b,a,4);a+=4;c.readUint(b,a);a+=4;var k=c.readUint(b,a);a+=4;var m=c.readUint(b,a);a+=4;l[g]={offset:k,length:m}}for(n=0;n<h.length;n++)a=h[n],l[a]&&(d[a.trim()]=f[a.trim()].parse(b,l[a].offset,l[a].length,d));return d},_tabOffset:function(b,a,c){var d=f._bin,e=d.readUshort(b,c+4);c+=12;for(var h=0;h<e;h++){var l=d.readASCII(b,c,4);c+=4;d.readUint(b,c);c+=4;var n=d.readUint(b,c);if(c+=4,d.readUint(b,c),c+=4,l==a)return n}return 0}};
f._bin={readFixed:function(b,a){return(b[a]<<8|b[a+1])+(b[a+2]<<8|b[a+3])/65540},readF2dot14:function(b,a){return f._bin.readShort(b,a)/16384},readInt:function(b,a){return f._bin._view(b).getInt32(a)},readInt8:function(b,a){return f._bin._view(b).getInt8(a)},readShort:function(b,a){return f._bin._view(b).getInt16(a)},readUshort:function(b,a){return f._bin._view(b).getUint16(a)},readUshorts:function(b,a,c){for(var d=[],e=0;e<c;e++)d.push(f._bin.readUshort(b,a+2*e));return d},readUint:function(b,a){return f._bin._view(b).getUint32(a)},
readUint64:function(b,a){return 4294967296*f._bin.readUint(b,a)+f._bin.readUint(b,a+4)},readASCII:function(b,a,c){for(var d="",e=0;e<c;e++)d+=String.fromCharCode(b[a+e]);return d},readUnicode:function(b,a,c){for(var d="",e=0;e<c;e++){var f=b[a++]<<8|b[a++];d+=String.fromCharCode(f)}return d},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(b,a,c){var d=f._bin._tdec;return d&&0==a&&c==b.length?d.decode(b):f._bin.readASCII(b,a,c)},readBytes:function(b,
a,c){for(var d=[],e=0;e<c;e++)d.push(b[a+e]);return d},readASCIIArray:function(b,a,c){for(var d=[],e=0;e<c;e++)d.push(String.fromCharCode(b[a+e]));return d},_view:function(b){return b._dataView||(b._dataView=b.buffer?new DataView(b.buffer,b.byteOffset,b.byteLength):new DataView((new Uint8Array(b)).buffer))}};f._lctf={};f._lctf.parse=function(b,a,c,d,e){var h=f._bin;c={};d=a;h.readFixed(b,a);a+=4;var l=h.readUshort(b,a);a+=2;var n=h.readUshort(b,a);a=h.readUshort(b,a+2);return c.scriptList=f._lctf.readScriptList(b,
d+l),c.featureList=f._lctf.readFeatureList(b,d+n),c.lookupList=f._lctf.readLookupList(b,d+a,e),c};f._lctf.readLookupList=function(b,a,c){var d=f._bin,e=a,h=[],l=d.readUshort(b,a);a+=2;for(var n=0;n<l;n++){var g=d.readUshort(b,a);a+=2;g=f._lctf.readLookupTable(b,e+g,c);h.push(g)}return h};f._lctf.readLookupTable=function(b,a,c){var d=f._bin,e=a,h={tabs:[]};h.ltype=d.readUshort(b,a);a+=2;h.flag=d.readUshort(b,a);a+=2;var l=d.readUshort(b,a);a+=2;for(var n=h.ltype,g=0;g<l;g++){var k=d.readUshort(b,a);
a+=2;k=c(b,n,e+k,h);h.tabs.push(k)}return h};f._lctf.numOfOnes=function(b){for(var a=0,c=0;32>c;c++)0!=(b>>>c&1)&&a++;return a};f._lctf.readClassDef=function(b,a){var c=f._bin,d=[],e=c.readUshort(b,a);if(a+=2,1==e){var h=c.readUshort(b,a);a+=2;var l=c.readUshort(b,a);a+=2;for(var n=0;n<l;n++)d.push(h+n),d.push(h+n),d.push(c.readUshort(b,a)),a+=2}if(2==e)for(e=c.readUshort(b,a),a+=2,n=0;n<e;n++)d.push(c.readUshort(b,a)),a+=2,d.push(c.readUshort(b,a)),a+=2,d.push(c.readUshort(b,a)),a+=2;return d};f._lctf.getInterval=
function(b,a){for(var c=0;c<b.length;c+=3){var d=b[c],e=b[c+1];if(b[c+2],d<=a&&a<=e)return c}return-1};f._lctf.readCoverage=function(b,a){var c=f._bin,d={};d.fmt=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);return a+=2,1==d.fmt&&(d.tab=c.readUshorts(b,a,e)),2==d.fmt&&(d.tab=c.readUshorts(b,a,3*e)),d};f._lctf.coverageIndex=function(b,a){var c=b.tab;return 1==b.fmt?c.indexOf(a):2==b.fmt&&(b=f._lctf.getInterval(c,a),-1!=b)?c[b+2]+(a-c[b]):-1};f._lctf.readFeatureList=function(b,a){var c=f._bin,d=a,
e=[],h=c.readUshort(b,a);a+=2;for(var l=0;l<h;l++){var n=c.readASCII(b,a,4);a+=4;var g=c.readUshort(b,a);a+=2;g=f._lctf.readFeatureTable(b,d+g);g.tag=n.trim();e.push(g)}return e};f._lctf.readFeatureTable=function(b,a){var c=f._bin,d=a,e={},h=c.readUshort(b,a);a+=2;0<h&&(e.featureParams=d+h);d=c.readUshort(b,a);a+=2;e.tab=[];for(h=0;h<d;h++)e.tab.push(c.readUshort(b,a+2*h));return e};f._lctf.readScriptList=function(b,a){var c=f._bin,d=a,e={},h=c.readUshort(b,a);a+=2;for(var l=0;l<h;l++){var n=c.readASCII(b,
a,4);a+=4;var g=c.readUshort(b,a);a+=2;e[n.trim()]=f._lctf.readScriptTable(b,d+g)}return e};f._lctf.readScriptTable=function(b,a){var c=f._bin,d=a,e={},h=c.readUshort(b,a);a+=2;0<h&&(e.default=f._lctf.readLangSysTable(b,d+h));h=c.readUshort(b,a);a+=2;for(var l=0;l<h;l++){var n=c.readASCII(b,a,4);a+=4;var g=c.readUshort(b,a);a+=2;e[n.trim()]=f._lctf.readLangSysTable(b,d+g)}return e};f._lctf.readLangSysTable=function(b,a){var c=f._bin,d={};c.readUshort(b,a);a+=2;d.reqFeature=c.readUshort(b,a);a+=2;
var e=c.readUshort(b,a);return a+=2,d.features=c.readUshorts(b,a,e),d};f.CFF={};f.CFF.parse=function(b,a,c){var d=f._bin;(b=new Uint8Array(b.buffer,a,c))[a=0];b[++a];b[++a];b[++a];a++;var e=[];a=f.CFF.readIndex(b,a,e);var h=[];for(c=0;c<e.length-1;c++)h.push(d.readASCII(b,a+e[c],e[c+1]-e[c]));a+=e[e.length-1];e=[];a=f.CFF.readIndex(b,a,e);h=[];for(c=0;c<e.length-1;c++)h.push(f.CFF.readDict(b,a+e[c],a+e[c+1]));a+=e[e.length-1];e=h[0];var l=[];a=f.CFF.readIndex(b,a,l);h=[];for(c=0;c<l.length-1;c++)h.push(d.readASCII(b,
a+l[c],l[c+1]-l[c]));if(a+=l[l.length-1],f.CFF.readSubrs(b,a,e),e.CharStrings){a=e.CharStrings;l=[];a=f.CFF.readIndex(b,a,l);var n=[];for(c=0;c<l.length-1;c++)n.push(d.readBytes(b,a+l[c],l[c+1]-l[c]));e.CharStrings=n}if(e.ROS){a=e.FDArray;l=[];a=f.CFF.readIndex(b,a,l);e.FDArray=[];for(c=0;c<l.length-1;c++)n=f.CFF.readDict(b,a+l[c],a+l[c+1]),f.CFF._readFDict(b,n,h),e.FDArray.push(n);a=e.FDSelect;e.FDSelect=[];c=b[a];if(a++,3!=c)throw c;l=d.readUshort(b,a);a+=2;for(c=0;c<l+1;c++)e.FDSelect.push(d.readUshort(b,
a),b[a+2]),a+=3}return e.Encoding&&(e.Encoding=f.CFF.readEncoding(b,e.Encoding,e.CharStrings.length)),e.charset&&(e.charset=f.CFF.readCharset(b,e.charset,e.CharStrings.length)),f.CFF._readFDict(b,e,h),e};f.CFF._readFDict=function(b,a,c){var d,e;for(e in a.Private&&(d=a.Private[1],a.Private=f.CFF.readDict(b,d,d+a.Private[0]),a.Private.Subrs&&f.CFF.readSubrs(b,d+a.Private.Subrs,a.Private)),a)-1!="FamilyName FontName FullName Notice version Copyright".split(" ").indexOf(e)&&(a[e]=c[a[e]-426+35])};f.CFF.readSubrs=
function(b,a,c){var d=f._bin,e=[];a=f.CFF.readIndex(b,a,e);var h=e.length;c.Bias=1240>h?107:33900>h?1131:32768;c.Subrs=[];for(h=0;h<e.length-1;h++)c.Subrs.push(d.readBytes(b,a+e[h],e[h+1]-e[h]))};f.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,
80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0];f.CFF.glyphByUnicode=function(b,a){for(var c=0;c<b.charset.length;c++)if(b.charset[c]==a)return c;
return-1};f.CFF.glyphBySE=function(b,a){return 0>a||255<a?-1:f.CFF.glyphByUnicode(b,f.CFF.tableSE[a])};f.CFF.readEncoding=function(b,a,c){f._bin;c=[".notdef"];var d=b[a];if(a++,0!=d)throw"error: unknown encoding format: "+d;d=b[a];a++;for(var e=0;e<d;e++)c.push(b[a+e]);return c};f.CFF.readCharset=function(b,a,c){var d=f._bin,e=[".notdef"],h=b[a];if(a++,0==h)for(var l=0;l<c;l++){var n=d.readUshort(b,a);a+=2;e.push(n)}else{if(1!=h&&2!=h)throw"error: format: "+h;for(;e.length<c;){n=d.readUshort(b,a);
a+=2;var g=0;1==h?(g=b[a],a++):(g=d.readUshort(b,a),a+=2);for(l=0;l<=g;l++)e.push(n),n++}}return e};f.CFF.readIndex=function(b,a,c){var d=f._bin,e=d.readUshort(b,a)+1,h=b[a+=2];if(a++,1==h)for(var l=0;l<e;l++)c.push(b[a+l]);else if(2==h)for(l=0;l<e;l++)c.push(d.readUshort(b,a+2*l));else if(3==h)for(l=0;l<e;l++)c.push(16777215&d.readUint(b,a+3*l-1));else if(1!=e)throw"unsupported offset size: "+h+", count: "+e;return a+e*h-1};f.CFF.getCharString=function(b,a,c){var d=f._bin,e=b[a],h=b[a+1];b[a+2];
b[a+3];b[a+4];var l=1,g=null,k=null;20>=e&&(g=e,l=1);12==e&&(g=100*e+h,l=2);21<=e&&27>=e&&(g=e,l=1);28==e&&(k=d.readShort(b,a+1),l=3);29<=e&&31>=e&&(g=e,l=1);32<=e&&246>=e&&(k=e-139,l=1);247<=e&&250>=e&&(k=256*(e-247)+h+108,l=2);251<=e&&254>=e&&(k=256*-(e-251)-h-108,l=2);255==e&&(k=d.readInt(b,a+1)/65535,l=5);c.val=null!=k?k:"o"+g;c.size=l};f.CFF.readCharString=function(b,a,c){c=a+c;for(var d=f._bin,e=[];a<c;){var h=b[a],l=b[a+1];b[a+2];b[a+3];b[a+4];var g=1,k=null,m=null;20>=h&&(k=h,g=1);12==h&&
(k=100*h+l,g=2);19!=h&&20!=h||(k=h,g=2);21<=h&&27>=h&&(k=h,g=1);28==h&&(m=d.readShort(b,a+1),g=3);29<=h&&31>=h&&(k=h,g=1);32<=h&&246>=h&&(m=h-139,g=1);247<=h&&250>=h&&(m=256*(h-247)+l+108,g=2);251<=h&&254>=h&&(m=256*-(h-251)-l-108,g=2);255==h&&(m=d.readInt(b,a+1)/65535,g=5);e.push(null!=m?m:"o"+k);a+=g}return e};f.CFF.readDict=function(b,a,c){for(var d=f._bin,e={},h=[];a<c;){var l=b[a],g=b[a+1];b[a+2];b[a+3];b[a+4];var k=1,m=null,x=null;if(28==l&&(x=d.readShort(b,a+1),k=3),29==l&&(x=d.readInt(b,a+
1),k=5),32<=l&&246>=l&&(x=l-139,k=1),247<=l&&250>=l&&(x=256*(l-247)+g+108,k=2),251<=l&&254>=l&&(x=256*-(l-251)-g-108,k=2),255==l)throw d.readInt(b,a+1),"unknown number";if(30==l){x=[];for(k=1;;){var p=b[a+k];k++;var q=p>>4;p&=15;if(15!=q&&x.push(q),15!=p&&x.push(p),15==p)break}q="";p=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"];for(var r=0;r<x.length;r++)q+=p[x[r]];x=parseFloat(q)}21>=l&&(m="version Notice FullName FamilyName Weight FontBBox BlueValues OtherBlues FamilyBlues FamilyOtherBlues StdHW StdVW escape UniqueID XUID charset Encoding CharStrings Private Subrs defaultWidthX nominalWidthX".split(" ")[l],
k=1,12==l)&&(m=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][g],k=2);null!=m?(e[m]=1==h.length?h[0]:
h,h=[]):h.push(x);a+=k}return e};f.cmap={};f.cmap.parse=function(b,a,c){b=new Uint8Array(b.buffer,a,c);a=0;c=f._bin;var d={};c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;var h=[];d.tables=[];for(var l=0;l<e;l++){var g=c.readUshort(b,a);a+=2;var k=c.readUshort(b,a);a+=2;var m=c.readUint(b,a);a+=4;var x="p"+g+"e"+k,p=h.indexOf(m);if(-1==p){var q;p=d.tables.length;h.push(m);var r=c.readUshort(b,m);0==r?q=f.cmap.parse0(b,m):4==r?q=f.cmap.parse4(b,m):6==r?q=f.cmap.parse6(b,m):12==r?q=f.cmap.parse12(b,
m):console.debug("unknown format: "+r,g,k,m);d.tables.push(q)}if(null!=d[x])throw"multiple tables for one platform+encoding";d[x]=p}return d};f.cmap.parse0=function(b,a){var c=f._bin,d={};d.format=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;d.map=[];for(c=0;c<e-6;c++)d.map.push(b[a+c]);return d};f.cmap.parse4=function(b,a){var c=f._bin,d=a,e={};e.format=c.readUshort(b,a);a+=2;var h=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;var l=c.readUshort(b,a);a+=2;l/=2;e.searchRange=
c.readUshort(b,a);a+=2;e.entrySelector=c.readUshort(b,a);a+=2;e.rangeShift=c.readUshort(b,a);a+=2;e.endCount=c.readUshorts(b,a,l);a=a+2*l+2;e.startCount=c.readUshorts(b,a,l);a+=2*l;e.idDelta=[];for(var g=0;g<l;g++)e.idDelta.push(c.readShort(b,a)),a+=2;e.idRangeOffset=c.readUshorts(b,a,l);a+=2*l;for(e.glyphIdArray=[];a<d+h;)e.glyphIdArray.push(c.readUshort(b,a)),a+=2;return e};f.cmap.parse6=function(b,a){var c=f._bin,d={};d.format=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=
2;d.firstCode=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;d.glyphIdArray=[];for(var h=0;h<e;h++)d.glyphIdArray.push(c.readUshort(b,a)),a+=2;return d};f.cmap.parse12=function(b,a){var c=f._bin,d={};d.format=c.readUshort(b,a);a=a+2+2;c.readUint(b,a);a+=4;c.readUint(b,a);a+=4;var e=c.readUint(b,a);a+=4;d.groups=[];for(var h=0;h<e;h++){var l=a+12*h,g=c.readUint(b,l+0),k=c.readUint(b,l+4);l=c.readUint(b,l+8);d.groups.push([g,k,l])}return d};f.glyf={};f.glyf.parse=function(b,a,c,d){b=[];for(a=0;a<
d.maxp.numGlyphs;a++)b.push(null);return b};f.glyf._parseGlyf=function(b,a){var c=f._bin,d=b._data,e=f._tabOffset(d,"glyf",b._offset)+b.loca[a];if(b.loca[a]==b.loca[a+1])return null;b={};if(b.noc=c.readShort(d,e),e+=2,b.xMin=c.readShort(d,e),e+=2,b.yMin=c.readShort(d,e),e+=2,b.xMax=c.readShort(d,e),e+=2,b.yMax=c.readShort(d,e),e+=2,b.xMin>=b.xMax||b.yMin>=b.yMax)return null;if(0<b.noc){b.endPts=[];for(a=0;a<b.noc;a++)b.endPts.push(c.readUshort(d,e)),e+=2;a=c.readUshort(d,e);if(e+=2,d.length-e<a)return null;
b.instructions=c.readBytes(d,e,a);e+=a;var h=b.endPts[b.noc-1]+1;b.flags=[];for(a=0;a<h;a++){var l=d[e];if(e++,b.flags.push(l),0!=(8&l)){var g=d[e];e++;for(var k=0;k<g;k++)b.flags.push(l),a++}}b.xs=[];for(a=0;a<h;a++)l=0!=(2&b.flags[a]),g=0!=(16&b.flags[a]),l?(b.xs.push(g?d[e]:-d[e]),e++):g?b.xs.push(0):(b.xs.push(c.readShort(d,e)),e+=2);b.ys=[];for(a=0;a<h;a++)l=0!=(4&b.flags[a]),g=0!=(32&b.flags[a]),l?(b.ys.push(g?d[e]:-d[e]),e++):g?b.ys.push(0):(b.ys.push(c.readShort(d,e)),e+=2);for(a=e=d=0;a<
h;a++)d+=b.xs[a],e+=b.ys[a],b.xs[a]=d,b.ys[a]=e}else{b.parts=[];do a=c.readUshort(d,e),e+=2,h={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1},(b.parts.push(h),h.glyphIndex=c.readUshort(d,e),e+=2,1&a)?(l=c.readShort(d,e),e+=2,g=c.readShort(d,e),e+=2):(l=c.readInt8(d,e),e++,g=c.readInt8(d,e),e++),2&a?(h.m.tx=l,h.m.ty=g):(h.p1=l,h.p2=g),8&a?(h.m.a=h.m.d=c.readF2dot14(d,e),e+=2):64&a?(h.m.a=c.readF2dot14(d,e),e+=2,h.m.d=c.readF2dot14(d,e),e+=2):128&a&&(h.m.a=c.readF2dot14(d,e),e+=2,h.m.b=c.readF2dot14(d,
e),e+=2,h.m.c=c.readF2dot14(d,e),e+=2,h.m.d=c.readF2dot14(d,e),e+=2);while(32&a);if(256&a)for(c=c.readUshort(d,e),e+=2,b.instr=[],a=0;a<c;a++)b.instr.push(d[e]),e++}return b};f.GPOS={};f.GPOS.parse=function(b,a,c,d){return f._lctf.parse(b,a,c,d,f.GPOS.subt)};f.GPOS.subt=function(b,a,c,d){var e=f._bin,h=c,l={};if(l.fmt=e.readUshort(b,c),c+=2,1==a||2==a||3==a||7==a||8==a&&2>=l.fmt){var g=e.readUshort(b,c);c+=2;l.coverage=f._lctf.readCoverage(b,g+h)}if(1==a&&1==l.fmt)d=e.readUshort(b,c),c+=2,f._lctf.numOfOnes(d),
0!=d&&(l.pos=f.GPOS.readValueRecord(b,c,d));else if(2==a&&1<=l.fmt&&2>=l.fmt){d=e.readUshort(b,c);c+=2;g=e.readUshort(b,c);c+=2;a=f._lctf.numOfOnes(d);var k=f._lctf.numOfOnes(g);if(1==l.fmt){l.pairsets=[];var m=e.readUshort(b,c);c+=2;for(var x=0;x<m;x++){var p=h+e.readUshort(b,c);c+=2;var q=e.readUshort(b,p);p+=2;for(var r=[],u=0;u<q;u++){var t=e.readUshort(b,p);p+=2;0!=d&&(v=f.GPOS.readValueRecord(b,p,d),p+=2*a);0!=g&&(G=f.GPOS.readValueRecord(b,p,g),p+=2*k);r.push({gid2:t,val1:v,val2:G})}l.pairsets.push(r)}}if(2==
l.fmt)for(v=e.readUshort(b,c),c+=2,G=e.readUshort(b,c),c+=2,m=e.readUshort(b,c),c+=2,e=e.readUshort(b,c),c+=2,l.classDef1=f._lctf.readClassDef(b,h+v),l.classDef2=f._lctf.readClassDef(b,h+G),l.matrix=[],x=0;x<m;x++){h=[];for(u=0;u<e;u++){var v=null,G=null;0!=d&&(v=f.GPOS.readValueRecord(b,c,d),c+=2*a);0!=g&&(G=f.GPOS.readValueRecord(b,c,g),c+=2*k);h.push({val1:v,val2:G})}l.matrix.push(h)}}else{if(9==a&&1==l.fmt){l=e.readUshort(b,c);c=e.readUint(b,c+2);if(9==d.ltype)d.ltype=l;else if(d.ltype!=l)throw"invalid extension substitution";
return f.GPOS.subt(b,d.ltype,h+c)}console.debug("unsupported GPOS table LookupType",a,"format",l.fmt)}return l};f.GPOS.readValueRecord=function(b,a,c){var d=f._bin,e=[];return e.push(1&c?d.readShort(b,a):0),a+=1&c?2:0,e.push(2&c?d.readShort(b,a):0),a+=2&c?2:0,e.push(4&c?d.readShort(b,a):0),a+=4&c?2:0,e.push(8&c?d.readShort(b,a):0),e};f.GSUB={};f.GSUB.parse=function(b,a,c,d){return f._lctf.parse(b,a,c,d,f.GSUB.subt)};f.GSUB.subt=function(b,a,c,d){var e=f._bin,h=c,l={};if(l.fmt=e.readUshort(b,c),c+=
2,1!=a&&4!=a&&5!=a&&6!=a)return null;if(1==a||4==a||5==a&&2>=l.fmt||6==a&&2>=l.fmt){var g=e.readUshort(b,c);c+=2;l.coverage=f._lctf.readCoverage(b,h+g)}if(1==a&&1<=l.fmt&&2>=l.fmt)1==l.fmt?l.delta=e.readShort(b,c):2==l.fmt&&(a=e.readUshort(b,c),l.newg=e.readUshorts(b,c+2,a));else if(4==a)for(l.vals=[],a=e.readUshort(b,c),c+=2,d=0;d<a;d++)g=e.readUshort(b,c),c+=2,l.vals.push(f.GSUB.readLigatureSet(b,h+g));else if(5==a&&2==l.fmt){if(2==l.fmt)for(d=e.readUshort(b,c),c+=2,l.cDef=f._lctf.readClassDef(b,
h+d),l.scset=[],a=e.readUshort(b,c),c+=2,d=0;d<a;d++)g=e.readUshort(b,c),c+=2,l.scset.push(0==g?null:f.GSUB.readSubClassSet(b,h+g))}else if(6==a&&3==l.fmt){if(3==l.fmt){for(d=0;3>d;d++){a=e.readUshort(b,c);c+=2;g=[];for(var k=0;k<a;k++)g.push(f._lctf.readCoverage(b,h+e.readUshort(b,c+2*k)));c+=2*a;0==d&&(l.backCvg=g);1==d&&(l.inptCvg=g);2==d&&(l.ahedCvg=g)}a=e.readUshort(b,c);l.lookupRec=f.GSUB.readSubstLookupRecords(b,c+2,a)}}else{if(7==a&&1==l.fmt){l=e.readUshort(b,c);c=e.readUint(b,c+2);if(9==
d.ltype)d.ltype=l;else if(d.ltype!=l)throw"invalid extension substitution";return f.GSUB.subt(b,d.ltype,h+c)}console.debug("unsupported GSUB table LookupType",a,"format",l.fmt)}return l};f.GSUB.readSubClassSet=function(b,a){var c=f._bin.readUshort,d=a,e=[],h=c(b,a);a+=2;for(var g=0;g<h;g++){var n=c(b,a);a+=2;e.push(f.GSUB.readSubClassRule(b,d+n))}return e};f.GSUB.readSubClassRule=function(b,a){var c=f._bin.readUshort,d={},e=c(b,a),h=c(b,a+=2);a+=2;d.input=[];for(var g=0;g<e-1;g++)d.input.push(c(b,
a)),a+=2;return d.substLookupRecords=f.GSUB.readSubstLookupRecords(b,a,h),d};f.GSUB.readSubstLookupRecords=function(b,a,c){for(var d=f._bin.readUshort,e=[],h=0;h<c;h++)e.push(d(b,a),d(b,a+2)),a+=4;return e};f.GSUB.readChainSubClassSet=function(b,a){var c=f._bin,d=a,e=[],h=c.readUshort(b,a);a+=2;for(var g=0;g<h;g++){var n=c.readUshort(b,a);a+=2;e.push(f.GSUB.readChainSubClassRule(b,d+n))}return e};f.GSUB.readChainSubClassRule=function(b,a){for(var c=f._bin,d={},e=["backtrack","input","lookahead"],
h=0;h<e.length;h++){var g=c.readUshort(b,a);a+=2;1==h&&g--;d[e[h]]=c.readUshorts(b,a,g);a+=2*d[e[h]].length}g=c.readUshort(b,a);return a+=2,d.subst=c.readUshorts(b,a,2*g),d};f.GSUB.readLigatureSet=function(b,a){var c=f._bin,d=a,e=[],h=c.readUshort(b,a);a+=2;for(var g=0;g<h;g++){var n=c.readUshort(b,a);a+=2;e.push(f.GSUB.readLigature(b,d+n))}return e};f.GSUB.readLigature=function(b,a){var c=f._bin,d={chain:[]};d.nglyph=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;for(var h=0;h<e-1;h++)d.chain.push(c.readUshort(b,
a)),a+=2;return d};f.head={};f.head.parse=function(b,a,c){c=f._bin;var d={};return c.readFixed(b,a),a+=4,d.fontRevision=c.readFixed(b,a),a+=4,c.readUint(b,a),a+=4,c.readUint(b,a),a+=4,d.flags=c.readUshort(b,a),a+=2,d.unitsPerEm=c.readUshort(b,a),a+=2,d.created=c.readUint64(b,a),a+=8,d.modified=c.readUint64(b,a),a+=8,d.xMin=c.readShort(b,a),a+=2,d.yMin=c.readShort(b,a),a+=2,d.xMax=c.readShort(b,a),a+=2,d.yMax=c.readShort(b,a),a+=2,d.macStyle=c.readUshort(b,a),a+=2,d.lowestRecPPEM=c.readUshort(b,a),
a+=2,d.fontDirectionHint=c.readShort(b,a),a+=2,d.indexToLocFormat=c.readShort(b,a),a+=2,d.glyphDataFormat=c.readShort(b,a),d};f.hhea={};f.hhea.parse=function(b,a,c){c=f._bin;var d={};return c.readFixed(b,a),a+=4,d.ascender=c.readShort(b,a),a+=2,d.descender=c.readShort(b,a),a+=2,d.lineGap=c.readShort(b,a),a+=2,d.advanceWidthMax=c.readUshort(b,a),a+=2,d.minLeftSideBearing=c.readShort(b,a),a+=2,d.minRightSideBearing=c.readShort(b,a),a+=2,d.xMaxExtent=c.readShort(b,a),a+=2,d.caretSlopeRise=c.readShort(b,
a),a+=2,d.caretSlopeRun=c.readShort(b,a),a+=2,d.caretOffset=c.readShort(b,a),a+=2,a+=8,d.metricDataFormat=c.readShort(b,a),a+=2,d.numberOfHMetrics=c.readUshort(b,a),d};f.hmtx={};f.hmtx.parse=function(b,a,c,d){c=f._bin;for(var e={aWidth:[],lsBearing:[]},h=0,g=0,n=0;n<d.maxp.numGlyphs;n++)n<d.hhea.numberOfHMetrics&&(h=c.readUshort(b,a),a+=2,g=c.readShort(b,a),a+=2),e.aWidth.push(h),e.lsBearing.push(g);return e};f.kern={};f.kern.parse=function(b,a,c,d){var e=f._bin,h=e.readUshort(b,a);if(a+=2,1==h)return f.kern.parseV1(b,
a-2,c,d);c=e.readUshort(b,a);a+=2;d={glyph1:[],rval:[]};for(h=0;h<c;h++){a+=2;e.readUshort(b,a);a+=2;var g=e.readUshort(b,a);a+=2;g>>>=8;if(0!=(g&=15))throw"unknown kern table format: "+g;a=f.kern.readFormat0(b,a,d)}return d};f.kern.parseV1=function(b,a,c,d){c=f._bin;c.readFixed(b,a);a+=4;d=c.readUint(b,a);a+=4;for(var e={glyph1:[],rval:[]},h=0;h<d;h++){c.readUint(b,a);a+=4;var g=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;g>>>=8;if(0!=(g&=15))throw"unknown kern table format: "+g;a=f.kern.readFormat0(b,
a,e)}return e};f.kern.readFormat0=function(b,a,c){var d=f._bin,e=-1,h=d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;for(var g=0;g<h;g++){var n=d.readUshort(b,a);a+=2;var k=d.readUshort(b,a);a+=2;var m=d.readShort(b,a);a+=2;n!=e&&(c.glyph1.push(n),c.rval.push({glyph2:[],vals:[]}));e=c.rval[c.rval.length-1];e.glyph2.push(k);e.vals.push(m);e=n}return a};f.loca={};f.loca.parse=function(b,a,c,d){c=f._bin;var e=[],h=d.head.indexToLocFormat;d=d.maxp.numGlyphs+
1;if(0==h)for(var g=0;g<d;g++)e.push(c.readUshort(b,a+(g<<1))<<1);if(1==h)for(g=0;g<d;g++)e.push(c.readUint(b,a+(g<<2)));return e};f.maxp={};f.maxp.parse=function(b,a,c){c=f._bin;var d={},e=c.readUint(b,a);return a+=4,d.numGlyphs=c.readUshort(b,a),a+=2,65536==e&&(d.maxPoints=c.readUshort(b,a),a+=2,d.maxContours=c.readUshort(b,a),a+=2,d.maxCompositePoints=c.readUshort(b,a),a+=2,d.maxCompositeContours=c.readUshort(b,a),a+=2,d.maxZones=c.readUshort(b,a),a+=2,d.maxTwilightPoints=c.readUshort(b,a),a+=
2,d.maxStorage=c.readUshort(b,a),a+=2,d.maxFunctionDefs=c.readUshort(b,a),a+=2,d.maxInstructionDefs=c.readUshort(b,a),a+=2,d.maxStackElements=c.readUshort(b,a),a+=2,d.maxSizeOfInstructions=c.readUshort(b,a),a+=2,d.maxComponentElements=c.readUshort(b,a),a+=2,d.maxComponentDepth=c.readUshort(b,a)),d};f.name={};f.name.parse=function(b,a,c){c=f._bin;var d={};c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;c.readUshort(b,a);for(var h,g="copyright fontFamily fontSubfamily ID fullName version postScriptName trademark manufacturer designer description urlVendor urlDesigner licence licenceURL --- typoFamilyName typoSubfamilyName compatibleFull sampleText postScriptCID wwsFamilyName wwsSubfamilyName lightPalette darkPalette".split(" "),
k=a+=2,m=0;m<e;m++){var w=c.readUshort(b,a);a+=2;var x=c.readUshort(b,a);a+=2;var p=c.readUshort(b,a);a+=2;var q=c.readUshort(b,a);a+=2;var r=c.readUshort(b,a);a+=2;var u=c.readUshort(b,a);a+=2;var t=g[q];u=k+12*e+u;if(0==w)r=c.readUnicode(b,u,r/2);else if(3==w&&0==x)r=c.readUnicode(b,u,r/2);else if(0==x)r=c.readASCII(b,u,r);else if(1==x)r=c.readUnicode(b,u,r/2);else if(3==x)r=c.readUnicode(b,u,r/2);else{if(1!=w)throw"unknown encoding "+x+", platformID: "+w;r=c.readASCII(b,u,r);console.debug("reading unknown MAC encoding "+
x+" as ASCII")}w="p"+w+","+p.toString(16);null==d[w]&&(d[w]={});d[w][void 0!==t?t:q]=r;d[w]._lang=p}for(var v in d)if(null!=d[v].postScriptName&&1033==d[v]._lang)return d[v];for(v in d)if(null!=d[v].postScriptName&&0==d[v]._lang)return d[v];for(v in d)if(null!=d[v].postScriptName&&3084==d[v]._lang)return d[v];for(v in d)if(null!=d[v].postScriptName)return d[v];for(v in d){h=v;break}return console.debug("returning name table with languageID "+d[h]._lang),d[h]};f["OS/2"]={};f["OS/2"].parse=function(b,
a,c){c=f._bin.readUshort(b,a);a+=2;var d={};if(0==c)f["OS/2"].version0(b,a,d);else if(1==c)f["OS/2"].version1(b,a,d);else if(2==c||3==c||4==c)f["OS/2"].version2(b,a,d);else{if(5!=c)throw"unknown OS/2 table version: "+c;f["OS/2"].version5(b,a,d)}return d};f["OS/2"].version0=function(b,a,c){var d=f._bin;return c.xAvgCharWidth=d.readShort(b,a),a+=2,c.usWeightClass=d.readUshort(b,a),a+=2,c.usWidthClass=d.readUshort(b,a),a+=2,c.fsType=d.readUshort(b,a),a+=2,c.ySubscriptXSize=d.readShort(b,a),a+=2,c.ySubscriptYSize=
d.readShort(b,a),a+=2,c.ySubscriptXOffset=d.readShort(b,a),a+=2,c.ySubscriptYOffset=d.readShort(b,a),a+=2,c.ySuperscriptXSize=d.readShort(b,a),a+=2,c.ySuperscriptYSize=d.readShort(b,a),a+=2,c.ySuperscriptXOffset=d.readShort(b,a),a+=2,c.ySuperscriptYOffset=d.readShort(b,a),a+=2,c.yStrikeoutSize=d.readShort(b,a),a+=2,c.yStrikeoutPosition=d.readShort(b,a),a+=2,c.sFamilyClass=d.readShort(b,a),a+=2,c.panose=d.readBytes(b,a,10),a+=10,c.ulUnicodeRange1=d.readUint(b,a),a+=4,c.ulUnicodeRange2=d.readUint(b,
a),a+=4,c.ulUnicodeRange3=d.readUint(b,a),a+=4,c.ulUnicodeRange4=d.readUint(b,a),a+=4,c.achVendID=[d.readInt8(b,a),d.readInt8(b,a+1),d.readInt8(b,a+2),d.readInt8(b,a+3)],a+=4,c.fsSelection=d.readUshort(b,a),a+=2,c.usFirstCharIndex=d.readUshort(b,a),a+=2,c.usLastCharIndex=d.readUshort(b,a),a+=2,c.sTypoAscender=d.readShort(b,a),a+=2,c.sTypoDescender=d.readShort(b,a),a+=2,c.sTypoLineGap=d.readShort(b,a),a+=2,c.usWinAscent=d.readUshort(b,a),a+=2,c.usWinDescent=d.readUshort(b,a),a+2};f["OS/2"].version1=
function(b,a,c){var d=f._bin;return a=f["OS/2"].version0(b,a,c),c.ulCodePageRange1=d.readUint(b,a),a+=4,c.ulCodePageRange2=d.readUint(b,a),a+4};f["OS/2"].version2=function(b,a,c){var d=f._bin;return a=f["OS/2"].version1(b,a,c),c.sxHeight=d.readShort(b,a),a+=2,c.sCapHeight=d.readShort(b,a),a+=2,c.usDefault=d.readUshort(b,a),a+=2,c.usBreak=d.readUshort(b,a),a+=2,c.usMaxContext=d.readUshort(b,a),a+2};f["OS/2"].version5=function(b,a,c){var d=f._bin;return a=f["OS/2"].version2(b,a,c),c.usLowerOpticalPointSize=
d.readUshort(b,a),a+=2,c.usUpperOpticalPointSize=d.readUshort(b,a),a+2};f.post={};f.post.parse=function(b,a,c){c=f._bin;var d={};return d.version=c.readFixed(b,a),a+=4,d.italicAngle=c.readFixed(b,a),a+=4,d.underlinePosition=c.readShort(b,a),a+=2,d.underlineThickness=c.readShort(b,a),d};null==f&&(f={});null==f.U&&(f.U={});f.U.codeToGlyph=function(b,a){b=b.cmap;var c=-1;if(null!=b.p0e4?c=b.p0e4:null!=b.p3e1?c=b.p3e1:null!=b.p1e0?c=b.p1e0:null!=b.p0e3&&(c=b.p0e3),-1==c)throw"no familiar platform and encoding!";
b=b.tables[c];if(0==b.format)return a>=b.map.length?0:b.map[a];if(4==b.format){var d=-1;for(c=0;c<b.endCount.length;c++)if(a<=b.endCount[c]){d=c;break}return-1==d||b.startCount[d]>a?0:65535&(0!=b.idRangeOffset[d]?b.glyphIdArray[a-b.startCount[d]+(b.idRangeOffset[d]>>1)-(b.idRangeOffset.length-d)]:a+b.idDelta[d])}if(12==b.format){if(a>b.groups[b.groups.length-1][1])return 0;for(c=0;c<b.groups.length;c++)if(d=b.groups[c],d[0]<=a&&a<=d[1])return d[2]+(a-d[0]);return 0}throw"unknown cmap table format "+
b.format;};f.U.glyphToPath=function(b,a){var c={cmds:[],crds:[]};if(b.SVG&&b.SVG.entries[a]){var d=b.SVG.entries[a];return null==d?c:("string"==typeof d&&(d=f.SVG.toPath(d),b.SVG.entries[a]=d),d)}if(b.CFF){d={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:b.CFF.Private?b.CFF.Private.defaultWidthX:0,open:!1};var e=b.CFF,h=b.CFF.Private;if(e.ROS){for(h=0;e.FDSelect[h+2]<=a;)h+=2;h=e.FDArray[e.FDSelect[h+1]].Private}f.U._drawCFF(b.CFF.CharStrings[a],d,e,h,c)}else b.glyf&&f.U._drawGlyf(a,b,c);return c};
f.U._drawGlyf=function(b,a,c){var d=a.glyf[b];null==d&&(d=a.glyf[b]=f.glyf._parseGlyf(a,b));null!=d&&(-1<d.noc?f.U._simpleGlyph(d,c):f.U._compoGlyph(d,a,c))};f.U._simpleGlyph=function(b,a){for(var c=0;c<b.noc;c++){for(var d=0==c?0:b.endPts[c-1]+1,e=b.endPts[c],h=d;h<=e;h++){var g=h==d?e:h-1,k=h==e?d:h+1,m=1&b.flags[h],w=1&b.flags[g],x=1&b.flags[k],p=b.xs[h],q=b.ys[h];if(h==d)if(m){if(!w){f.U.P.moveTo(a,p,q);continue}f.U.P.moveTo(a,b.xs[g],b.ys[g])}else w?f.U.P.moveTo(a,b.xs[g],b.ys[g]):f.U.P.moveTo(a,
(b.xs[g]+p)/2,(b.ys[g]+q)/2);m?w&&f.U.P.lineTo(a,p,q):x?f.U.P.qcurveTo(a,p,q,b.xs[k],b.ys[k]):f.U.P.qcurveTo(a,p,q,(p+b.xs[k])/2,(q+b.ys[k])/2)}f.U.P.closePath(a)}};f.U._compoGlyph=function(b,a,c){for(var d=0;d<b.parts.length;d++){var e={cmds:[],crds:[]},h=b.parts[d];f.U._drawGlyf(h.glyphIndex,a,e);h=h.m;for(var g=0;g<e.crds.length;g+=2){var k=e.crds[g],m=e.crds[g+1];c.crds.push(k*h.a+m*h.b+h.tx);c.crds.push(k*h.c+m*h.d+h.ty)}for(g=0;g<e.cmds.length;g++)c.cmds.push(e.cmds[g])}};f.U._getGlyphClass=
function(b,a){b=f._lctf.getInterval(a,b);return-1==b?0:a[b+2]};f.U.getPairAdjustment=function(b,a,c){var d=!1;if(b.GPOS){var e=b.GPOS,h=e.lookupList;e=e.featureList;for(var g=[],k=0;k<e.length;k++){var m=e[k];if("kern"==m.tag){d=!0;for(var w=0;w<m.tab.length;w++)if(!g[m.tab[w]]){g[m.tab[w]]=!0;for(var x=h[m.tab[w]],p=0;p<x.tabs.length;p++)if(null!=x.tabs[p]){var q,r=x.tabs[p];if((!r.coverage||-1!=(q=f._lctf.coverageIndex(r.coverage,a)))&&1!=x.ltype&&2==x.ltype){var u=null;if(1==r.fmt)for(r=r.pairsets[q],
k=0;k<r.length;k++)r[k].gid2==c&&(u=r[k]);else if(2==r.fmt){u=f.U._getGlyphClass(a,r.classDef1);var t=f.U._getGlyphClass(c,r.classDef2);u=r.matrix[u][t]}if(u)return b=0,u.val1&&u.val1[2]&&(b+=u.val1[2]),u.val2&&u.val2[0]&&(b+=u.val2[0]),b}}}}}}return b.kern&&!d&&(a=b.kern.glyph1.indexOf(a),-1!=a&&(c=b.kern.rval[a].glyph2.indexOf(c),-1!=c))?b.kern.rval[a].vals[c]:0};f.U._applySubs=function(b,a,c,d){for(var e=b.length-a-1,h=0;h<c.tabs.length;h++)if(null!=c.tabs[h]){var g,k=c.tabs[h];if(!k.coverage||
-1!=(g=f._lctf.coverageIndex(k.coverage,b[a])))if(1==c.ltype)b[a],1==k.fmt?b[a]+=k.delta:b[a]=k.newg[g];else if(4==c.ltype)for(var m=k.vals[g],w=0;w<m.length;w++){var x=m[w];k=x.chain.length;if(!(k>e)){for(var p=!0,q=0,r=0;r<k;r++){for(;-1==b[a+q+(1+r)];)q++;x.chain[r]!=b[a+q+(1+r)]&&(p=!1)}if(p){b[a]=x.nglyph;for(r=0;r<k+q;r++)b[a+r+1]=-1;break}}}else if(5==c.ltype&&2==k.fmt)for(m=f._lctf.getInterval(k.cDef,b[a]),q=k.scset[k.cDef[m+2]],x=0;x<q.length;x++){w=q[x];var u=w.input;if(!(u.length>e)){p=
!0;for(r=0;r<u.length;r++){var t=f._lctf.getInterval(k.cDef,b[a+1+r]);if(-1==m&&k.cDef[t+2]!=u[r]){p=!1;break}}if(p)for(p=w.substLookupRecords,w=0;w<p.length;w+=2)p[w],p[w+1]}}else if(6==c.ltype&&3==k.fmt&&f.U._glsCovered(b,k.backCvg,a-k.backCvg.length)&&f.U._glsCovered(b,k.inptCvg,a)&&f.U._glsCovered(b,k.ahedCvg,a+k.inptCvg.length))for(p=k.lookupRec,x=0;x<p.length;x+=2)m=p[x],f.U._applySubs(b,a+m,d[p[x+1]],d)}};f.U._glsCovered=function(b,a,c){for(var d=0;d<a.length;d++)if(-1==f._lctf.coverageIndex(a[d],
b[c+d]))return!1;return!0};f.U.glyphsToPath=function(b,a,c){for(var d={cmds:[],crds:[]},e=0,h=0;h<a.length;h++){var g=a[h];if(-1!=g){for(var k=h<a.length-1&&-1!=a[h+1]?a[h+1]:0,m=f.U.glyphToPath(b,g),w=0;w<m.crds.length;w+=2)d.crds.push(m.crds[w]+e),d.crds.push(m.crds[w+1]);c&&d.cmds.push(c);for(w=0;w<m.cmds.length;w++)d.cmds.push(m.cmds[w]);c&&d.cmds.push("X");e+=b.hmtx.aWidth[g];h<a.length-1&&(e+=f.U.getPairAdjustment(b,g,k))}}return d};f.U.P={};f.U.P.moveTo=function(b,a,c){b.cmds.push("M");b.crds.push(a,
c)};f.U.P.lineTo=function(b,a,c){b.cmds.push("L");b.crds.push(a,c)};f.U.P.curveTo=function(b,a,c,d,e,f,g){b.cmds.push("C");b.crds.push(a,c,d,e,f,g)};f.U.P.qcurveTo=function(b,a,c,d,e){b.cmds.push("Q");b.crds.push(a,c,d,e)};f.U.P.closePath=function(b){b.cmds.push("Z")};f.U._drawCFF=function(b,a,c,d,e){for(var h=a.stack,g=a.nStems,k=a.haveWidth,m=a.width,w=a.open,x=0,p=a.x,q=a.y,r=0,u=0,t=0,v=0,G=0,y=0,C=0,H=0,L=0,J=0,Y={val:0,size:0};x<b.length;){f.CFF.getCharString(b,x,Y);var z=Y.val;if(x+=Y.size,
"o1"==z||"o18"==z)0!=h.length%2&&!k&&(m=h.shift()+d.nominalWidthX),g+=h.length>>1,h.length=0,k=!0;else if("o3"==z||"o23"==z)0!=h.length%2&&!k&&(m=h.shift()+d.nominalWidthX),g+=h.length>>1,h.length=0,k=!0;else if("o4"==z)1<h.length&&!k&&(m=h.shift()+d.nominalWidthX,k=!0),w&&f.U.P.closePath(e),q+=h.pop(),f.U.P.moveTo(e,p,q),w=!0;else if("o5"==z)for(;0<h.length;)p+=h.shift(),q+=h.shift(),f.U.P.lineTo(e,p,q);else if("o6"==z||"o7"==z){var K=h.length,I="o6"==z;for(z=0;z<K;z++){var D=h.shift();I?p+=D:q+=
D;I=!I;f.U.P.lineTo(e,p,q)}}else if("o8"==z||"o24"==z){K=h.length;for(I=0;I+6<=K;)r=p+h.shift(),u=q+h.shift(),t=r+h.shift(),v=u+h.shift(),p=t+h.shift(),q=v+h.shift(),f.U.P.curveTo(e,r,u,t,v,p,q),I+=6;"o24"==z&&(p+=h.shift(),q+=h.shift(),f.U.P.lineTo(e,p,q))}else{if("o11"==z)break;if("o1234"==z||"o1235"==z||"o1236"==z||"o1237"==z)"o1234"==z&&(u=q,t=(r=p+h.shift())+h.shift(),J=v=u+h.shift(),y=v,H=q,p=(C=(G=(L=t+h.shift())+h.shift())+h.shift())+h.shift(),f.U.P.curveTo(e,r,u,t,v,L,J),f.U.P.curveTo(e,
G,y,C,H,p,q)),"o1235"==z&&(r=p+h.shift(),u=q+h.shift(),t=r+h.shift(),v=u+h.shift(),L=t+h.shift(),J=v+h.shift(),G=L+h.shift(),y=J+h.shift(),C=G+h.shift(),H=y+h.shift(),p=C+h.shift(),q=H+h.shift(),h.shift(),f.U.P.curveTo(e,r,u,t,v,L,J),f.U.P.curveTo(e,G,y,C,H,p,q)),"o1236"==z&&(r=p+h.shift(),u=q+h.shift(),t=r+h.shift(),J=v=u+h.shift(),y=v,C=(G=(L=t+h.shift())+h.shift())+h.shift(),H=y+h.shift(),p=C+h.shift(),f.U.P.curveTo(e,r,u,t,v,L,J),f.U.P.curveTo(e,G,y,C,H,p,q)),"o1237"==z&&(r=p+h.shift(),u=q+h.shift(),
t=r+h.shift(),v=u+h.shift(),L=t+h.shift(),J=v+h.shift(),G=L+h.shift(),y=J+h.shift(),C=G+h.shift(),H=y+h.shift(),Math.abs(C-p)>Math.abs(H-q)?p=C+h.shift():q=H+h.shift(),f.U.P.curveTo(e,r,u,t,v,L,J),f.U.P.curveTo(e,G,y,C,H,p,q));else if("o14"==z){if(0<h.length&&!k&&(m=h.shift()+c.nominalWidthX,k=!0),4==h.length)K=h.shift(),I=h.shift(),D=h.shift(),z=h.shift(),D=f.CFF.glyphBySE(c,D),z=f.CFF.glyphBySE(c,z),f.U._drawCFF(c.CharStrings[D],a,c,d,e),a.x=K,a.y=I,f.U._drawCFF(c.CharStrings[z],a,c,d,e);w&&(f.U.P.closePath(e),
w=!1)}else if("o19"==z||"o20"==z)0!=h.length%2&&!k&&(m=h.shift()+d.nominalWidthX),g+=h.length>>1,h.length=0,k=!0,x+=g+7>>3;else if("o21"==z)2<h.length&&!k&&(m=h.shift()+d.nominalWidthX,k=!0),q+=h.pop(),p+=h.pop(),w&&f.U.P.closePath(e),f.U.P.moveTo(e,p,q),w=!0;else if("o22"==z)1<h.length&&!k&&(m=h.shift()+d.nominalWidthX,k=!0),p+=h.pop(),w&&f.U.P.closePath(e),f.U.P.moveTo(e,p,q),w=!0;else if("o25"==z){for(;6<h.length;)p+=h.shift(),q+=h.shift(),f.U.P.lineTo(e,p,q);r=p+h.shift();u=q+h.shift();t=r+h.shift();
v=u+h.shift();p=t+h.shift();q=v+h.shift();f.U.P.curveTo(e,r,u,t,v,p,q)}else if("o26"==z)for(h.length%2&&(p+=h.shift());0<h.length;)r=p,u=q+h.shift(),p=t=r+h.shift(),q=(v=u+h.shift())+h.shift(),f.U.P.curveTo(e,r,u,t,v,p,q);else if("o27"==z)for(h.length%2&&(q+=h.shift());0<h.length;)u=q,t=(r=p+h.shift())+h.shift(),v=u+h.shift(),p=t+h.shift(),q=v,f.U.P.curveTo(e,r,u,t,v,p,q);else if("o10"==z||"o29"==z)K="o10"==z?d:c,0==h.length?console.debug("error: empty stack"):(I=h.pop(),K=K.Subrs[I+K.Bias],a.x=p,
a.y=q,a.nStems=g,a.haveWidth=k,a.width=m,a.open=w,f.U._drawCFF(K,a,c,d,e),p=a.x,q=a.y,g=a.nStems,k=a.haveWidth,m=a.width,w=a.open);else if("o30"==z||"o31"==z)for(K=h.length,z=(I=0,"o31"==z),I+=K-(K&=-3);I<K;)z?(u=q,t=(r=p+h.shift())+h.shift(),q=(v=u+h.shift())+h.shift(),5==K-I?(p=t+h.shift(),I++):p=t,z=!1):(r=p,u=q+h.shift(),t=r+h.shift(),v=u+h.shift(),p=t+h.shift(),5==K-I?(q=v+h.shift(),I++):q=v,z=!0),f.U.P.curveTo(e,r,u,t,v,p,q),I+=4;else{if("o"==(z+"").charAt(0))throw console.debug("Unknown operation: "+
z,b),z;h.push(z)}}}a.x=p;a.y=q;a.nStems=g;a.haveWidth=k;a.width=m;a.open=w};var k=f,m={Typr:k};return g.Typr=k,g.default=m,Object.defineProperty(g,"__esModule",{value:!0}),g}({}).Typr},function(){return function(g){var f=Uint8Array,k=Uint16Array,m=Uint32Array,b=new f([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a=new f([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),c=new f([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d=function(a,b){for(var c=
new k(31),d=0;31>d;++d)c[d]=b+=1<<a[d-1];a=new m(c[30]);for(d=1;30>d;++d)for(b=c[d];b<c[d+1];++b)a[b]=b-c[d]<<5|d;return[c,a]},e=d(b,2),h=e[0];e=e[1];h[28]=258;e[258]=28;var l=d(a,0)[0],n=new k(32768);for(d=0;32768>d;++d)e=(43690&d)>>>1|(21845&d)<<1,e=(61680&(e=(52428&e)>>>2|(13107&e)<<2))>>>4|(3855&e)<<4,n[d]=((65280&e)>>>8|(255&e)<<8)>>>1;var F=function(a,b,c){for(var d=a.length,e=0,f=new k(b);e<d;++e)++f[a[e]-1];var h=new k(b);for(e=0;e<b;++e)h[e]=h[e-1]+f[e-1]<<1;if(c)for(c=new k(1<<b),f=15-b,
e=0;e<d;++e){if(a[e]){var g=e<<4|a[e],l=b-a[e],m=h[a[e]-1]++<<l;for(l=m|(1<<l)-1;m<=l;++m)c[n[m]>>>f]=g}}else for(c=new k(d),e=0;e<d;++e)a[e]&&(c[e]=n[h[a[e]-1]++]>>>15-a[e]);return c};e=new f(288);for(d=0;144>d;++d)e[d]=8;for(d=144;256>d;++d)e[d]=9;for(d=256;280>d;++d)e[d]=7;for(d=280;288>d;++d)e[d]=8;var w=new f(32);for(d=0;32>d;++d)w[d]=5;var x=F(e,9,1),p=F(w,5,1),q=function(a){for(var b=a[0],c=1;c<a.length;++c)a[c]>b&&(b=a[c]);return b},r=function(a,b,c){var d=b/8|0;return(a[d]|a[d+1]<<8)>>(7&
b)&c},u=function(a,b){var c=b/8|0;return(a[c]|a[c+1]<<8|a[c+2]<<16)>>(7&b)},t=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],v=function(a,b,c){b=Error(b||t[a]);if(b.code=a,Error.captureStackTrace&&Error.captureStackTrace(b,v),!c)throw b;return b},G=function(d,e,g){var n=d.length;
if(!n||g&&!g.l&&5>n)return e||new f(0);var t=!e||g,w=!g||g.i;g||(g={});e||(e=new f(3*n));var z,H=function(a){var b=e.length;a>b&&(a=new f(Math.max(2*b,a)),a.set(e),e=a)},G=g.f||0,D=g.p||0,y=g.b||0,C=g.l,N=g.d,T=g.m,M=g.n,B=8*n;do{if(!C){g.f=G=r(d,D,1);var A=r(d,D+1,3);if(D+=3,!A){D=d[(U=((z=D)/8|0)+(7&z&&1)+4)-4]|d[U-3]<<8;A=U+D;if(A>n){w&&v(0);break}t&&H(y+D);e.set(d.subarray(U,A),y);g.b=y+=D;g.p=D=8*A;continue}if(1==A)C=x,N=p,T=9,M=5;else if(2==A){T=r(d,D,31)+257;N=r(d,D+10,15)+4;C=T+r(d,D+5,31)+
1;D+=14;M=new f(C);var O=new f(19);for(A=0;A<N;++A)O[c[A]]=r(d,D+3*A,7);D+=3*N;A=q(O);N=(1<<A)-1;var E=F(O,A,1);for(A=0;A<C;){var U;U=E[r(d,D,N)];if(D+=15&U,16>(U>>>=4))M[A++]=U;else{var fa=O=0;for(16==U?(fa=3+r(d,D,3),D+=2,O=M[A-1]):17==U?(fa=3+r(d,D,7),D+=3):18==U&&(fa=11+r(d,D,127),D+=7);fa--;)M[A++]=O}}C=M.subarray(0,T);A=M.subarray(T);T=q(C);M=q(A);C=F(C,T,1);N=F(A,M,1)}else v(1);if(D>B){w&&v(0);break}}t&&H(y+131072);E=(1<<T)-1;fa=(1<<M)-1;for(var pa=D;;pa=D){A=(O=C[u(d,D)&E])>>>4;if((D+=15&
O)>B){w&&v(0);break}if(O||v(2),256>A)e[y++]=A;else{if(256==A){pa=D;C=null;break}O=A-254;if(264<A){var Z=b[A-=257];O=r(d,D,(1<<Z)-1)+h[A];D+=Z}A=N[u(d,D)&fa];Z=A>>>4;A||v(3);D+=15&A;A=l[Z];3<Z&&(Z=a[Z],A+=u(d,D)&(1<<Z)-1,D+=Z);if(D>B){w&&v(0);break}t&&H(y+131072);for(O=y+O;y<O;y+=4)e[y]=e[y-A],e[y+1]=e[y+1-A],e[y+2]=e[y+2-A],e[y+3]=e[y+3-A];y=O}}g.l=C;g.p=pa;g.b=y;C&&(G=1,g.m=T,g.d=N,g.n=M)}while(!G);return y==e.length?e:function(a,b,c){(null==b||0>b)&&(b=0);(null==c||c>a.length)&&(c=a.length);var d=
new (a instanceof k?k:a instanceof m?m:f)(c-b);return d.set(a.subarray(b,c)),d}(e,0,y)};d=new f(0);e="undefined"!=typeof TextDecoder&&new TextDecoder;try{e.decode(d,{stream:!0}),1}catch(y){}return g.convert_streams=function(a){function b(){var a=f.getUint16(g);return g+=2,a}function c(){var a=f.getUint32(g);return g+=4,a}function d(a){w.setUint16(v,a);v+=2}function e(a){w.setUint32(v,a);v+=4}var f=new DataView(a),g=0;c();var h=c();c();var k=b();b();c();b();b();c();c();c();c();c();for(var l=0;Math.pow(2,
l)<=k;)l++;l--;for(var m=16*Math.pow(2,l),r=16*k-m,n=12,p=[],u=0;u<k;u++)p.push({tag:c(),offset:c(),compLength:c(),origLength:c(),origChecksum:c()}),n+=16;var q,t=new Uint8Array(12+16*p.length+p.reduce(function(a,b){return a+b.origLength+4},0));u=t.buffer;var w=new DataView(u),v=0;return e(h),d(k),d(m),d(l),d(r),p.forEach(function(a){e(a.tag);e(a.origChecksum);e(n);e(a.origLength);a.outOffset=n;0!=(n+=a.origLength)%4&&(n+=4-n%4)}),p.forEach(function(b){var c=a.slice(b.offset,b.offset+b.compLength);
if(b.compLength!=b.origLength){var d=new Uint8Array(b.origLength);c=new Uint8Array(c,2);G(c,d)}else d=new Uint8Array(c);t.set(d,b.outOffset);d=0;0!=(n=b.outOffset+b.origLength)%4&&(d=4-n%4);t.set((new Uint8Array(d)).buffer,b.outOffset+b.origLength);q=n+d}),u.slice(0,q)},Object.defineProperty(g,"__esModule",{value:!0}),g}({}).convert_streams},function(g,f){function k(a){if(!e){let a={R:2,L:1,D:4,C:16,U:32,T:8};e=new Map;for(let b in d){let c=0;d[b].split(",").forEach(d=>{let [f,g]=d.split("+");f=parseInt(f,
36);g=g?parseInt(g,36):0;e.set(c+=f,a[b]);for(d=g;d--;)e.set(++c,a[b])})}}return e.get(a)||32}function m(a,b){let c=[];for(let d=0;d<b.length;d++){let e=b.codePointAt(d);65535<e&&d++;c.push(g.U.codeToGlyph(a,e))}if(a=a.GSUB){let {lookupList:d,featureList:e}=a,f,l=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws)$/,m=[];e.forEach(a=>{if(l.test(a.tag))for(let l=0;l<a.tab.length;l++){if(m[a.tab[l]])continue;m[a.tab[l]]=!0;let r=d[a.tab[l]],n=/^(isol|init|fina|medi)$/.test(a.tag);if(n&&!f){{var e=
b;let a=new Uint8Array(e.length),c=32,d=1,g=-1;for(let b=0;b<e.length;b++){let f=e.codePointAt(b),h=k(f)|0,l=1;h&8||(c&21?h&22?(l=3,1!==d&&3!==d||a[g]++):h&33&&(2===d||4===d)&&a[g]--:c&34&&(2===d||4===d)&&a[g]--,d=a[b]=l,c=h,g=b,65535<f&&b++)}f=a}}for(e=0;e<c.length;e++)f&&n&&h[f[e]]!==a.tag||g.U._applySubs(c,e,r,d)}})}return c}function b(...a){for(let b=0;b<a.length;b++)if("number"===typeof a[b])return a[b]}function a(a){let d=Object.create(null),e=a["OS/2"],f=a.hhea,h=a.head.unitsPerEm,k=b(e&&e.sTypoAscender,
f&&f.ascender,h),l={unitsPerEm:h,ascender:k,descender:b(e&&e.sTypoDescender,f&&f.descender,0),capHeight:b(e&&e.sCapHeight,k),xHeight:b(e&&e.sxHeight,k),lineGap:b(e&&e.sTypoLineGap,f&&f.lineGap),supportsCodePoint(b){return 0<g.U.codeToGlyph(a,b)},forEachGlyph(b,e,f,h){let k=0;const r=1/l.unitsPerEm*e;let n=0,u=-1;m(a,b).forEach((l,m)=>{if(-1!==l){m=d[l];if(!m){const {cmds:b,crds:e}=g.U.glyphToPath(a,l);m="";var p=0;for(let a=0,d=b.length;a<d;a++){var q=c[b[a]];m+=b[a];for(var t=1;t<=q;t++)m+=(1<t?
",":"")+e[p++]}let f;if(e.length){p=q=Infinity;t=f=-Infinity;for(let a=0,b=e.length;a<b;a+=2){let b=e[a],c=e[a+1];b<p&&(p=b);c<q&&(q=c);b>t&&(t=b);c>f&&(f=c)}}else p=t=q=f=0;m=d[l]={index:l,advanceWidth:a.hmtx.aWidth[l],xMin:p,yMin:q,xMax:t,yMax:f,path:m,pathCommandCount:b.length}}-1!==u&&(k+=g.U.getPairAdjustment(a,u,l)*r);h.call(null,m,k,n);m.advanceWidth&&(k+=m.advanceWidth*r);f&&(k+=f*e);u=l}n+=65535<b.codePointAt(n)?2:1});return k}};return l}let c={M:2,L:2,Q:4,C:6,Z:0},d={C:"18g,ca,368,1kz",
D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},
e,h=[null,"isol","init","fina","medi"];return function(b){var c=new Uint8Array(b,0,4);c=g._bin.readASCII(c,0,4);if("wOFF"===c)b=f(b);else if("wOF2"===c)throw Error("woff2 fonts not supported");return a(g.parse(b)[0])}}],init(g,f,k){g=g();f=f();return k(g,f)}});aa=S.defineWorkerModule({name:"FontResolver",dependencies:[function(g,f){function k(a,b){let c=b=>{console.error(`Failure loading font ${a}`,b)};try{let d=new XMLHttpRequest;d.open("get",a,!0);d.responseType="arraybuffer";d.onload=function(){if(400<=
d.status)c(Error(d.statusText));else if(0<d.status)try{let c=g(d.response);c.src=a;b(c)}catch(l){c(l)}};d.onerror=c;d.send()}catch(h){c(h)}}function m(c,d){let e=b[c];e?d(e):a[c]?a[c].push(d):(a[c]=[d],k(c,d=>{d.src=c;b[c]=d;a[c].forEach(a=>a(d));delete a[c]}))}let b=Object.create(null),a=Object.create(null);return function(a,d,{lang:e,fonts:g=[],style:k="normal",weight:n="normal",unicodeFontsURL:F}={}){function c(){if(t.length){let b=t.map(b=>a.substring(b[0],b[1]+1)).join("\n");f.getFontsForString(b,
{lang:e,style:k,weight:n,dataUrl:F}).then(({fontUrls:a,chars:b})=>{let c=r.length,d=0;t.forEach(a=>{for(let e=0,f=a[1]-a[0];e<=f;e++)q[a[0]+e]=b[d++]+c;d++});let e=0;a.forEach((b,d)=>{m(b,b=>{r[d+c]=b;++e===a.length&&h()})})})}else h()}function h(){d({chars:q,fonts:r})}function l(a,b){for(let c=0;c<b.length;c++){let [d,e=d]=b[c];if(d<=a&&a<=e)return!0}return!1}let q=new Uint8Array(a.length),r=[];a.length||h();let u=new Map,t=[];"italic"!==k&&(k="normal");"number"!==typeof n&&(n="bold"===n?700:400);
g&&!Array.isArray(g)&&(g=[g]);g=g.slice().filter(a=>!a.lang||a.lang.test(e)).reverse();if(g.length){let d=0;(function C(e=0){for(let c=e,f=a.length;c<f;c++){e=a.codePointAt(c);if(1===d&&r[q[c-1]].supportsCodePoint(e)||/\s/.test(a[c]))q[c]=q[c-1],2===d&&(t[t.length-1][1]=c);else for(let a=q[c],f=g.length;a<=f;a++)if(a===f)(2===d?t[t.length-1]:t[t.length]=[c,c])[1]=c,d=2;else{q[c]=a;let {src:f,unicodeRange:h}=g[a];if(!h||l(e,h)){let a=b[f];if(!a){m(f,()=>{C(c)});return}if(a.supportsCodePoint(e)){let b=
u.get(a);"number"!==typeof b&&(b=r.length,r.push(a),u.set(a,b));q[c]=b;d=1;break}}}65535<e&&c+1<f&&(q[c+1]=q[c],c++,2===d&&(t[t.length-1][1]=c))}c()})()}else t.push([0,a.length-1]),c()}},aa,function(){return function(g){function f(a){var b=(a&n).toString(16),c=((a&n)+h-1).toString(16);return"codepoint-index/plane"+(a>>16)+"/"+b+"-"+c+".json"}function k(a,b){a&=l;return 0!=((b.codePointAt(a/6|0)||48)-48&1<<a%6)}function m(a,b){a.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(a){return a.split("-").map(function(a){return parseInt(a.trim(),
16)})}).forEach(function(a){var c=a[0];a=a[1];void 0===a&&(a=c);b(c,a)})}function b(a,b){m(a,function(a,c){for(;a<=c;a++)b(a)})}function a(a){var c=x.get(a);return c||(c=new e,b(a.ranges,function(a){return c.add(a)}),x.set(a,c)),c}function c(a,b,c){if(a[b])a=b;else if(a[c])a=c;else a:{for(var d in a){a=d;break a}a=void 0}return a}function d(a){return p||(p=new Set,b("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(a){p.add(a)})),p.has(a)}var e=function(){this.buckets=new Map};e.prototype.add=
function(a){var b=a>>5;this.buckets.set(b,(this.buckets.get(b)||0)|1<<(31&a))};e.prototype.has=function(a){var b=this.buckets.get(a>>5);return void 0!==b&&0!=(b&1<<(31&a))};e.prototype.serialize=function(){var a=[];return this.buckets.forEach(function(b,c){a.push((+c).toString(36)+":"+b.toString(36))}),a.join(",")};e.prototype.deserialize=function(a){var b=this;this.buckets.clear();a.split(",").forEach(function(a){a=a.split(":");b.buckets.set(parseInt(a[0],36),parseInt(a[1],36))})};var h=Math.pow(2,
8),l=h-1,n=~l,F={},w={},x=new WeakMap,p,q=new Map;return g.CodePointSet=e,g.clearCache=function(){F={};w={}},g.getFontsForString=function(b,e){function g(a){var b=q.get(a);return b||(b=fetch(p+"/"+a).then(function(a){if(!a.ok)throw Error(a.statusText);return a.json().then(function(a){if(!Array.isArray(a)||1!==a[0])throw Error("Incorrect schema version; need 1, got "+a[0]);return a[1]})}).catch(function(b){if("https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.0/packages/data"!==p)return D||
(console.error('unicode-font-resolver: Failed loading from dataUrl "'+p+'", trying default CDN. '+b.message),D=!0),p="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.0/packages/data",q.delete(a),g(a);throw b;}),q.set(a,b)),b}void 0===e&&(e={});var h=e.lang;void 0===h&&(h="en");var l=e.category;void 0===l&&(l="sans-serif");var m=e.style;void 0===m&&(m="normal");var n=e.weight;void 0===n&&(n=400);var p=(e.dataUrl||"https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.0/packages/data").replace(/\/$/g,
""),r=new Map,u=new Uint8Array(b.length),x={},z={},B=Array(b.length),I=new Map,D=!1;e=function(a){var c=b.codePointAt(a),d=f(c);B[a]=d;F[d]||I.has(d)||I.set(d,g(d).then(function(a){F[d]=a}));65535<c&&(a++,E=a)};for(var E=0;E<b.length;E++)e(E);return Promise.all(I.values()).then(function(){I.clear();for(var a=function(a){var d=b.codePointAt(a),e=null,f=F[B[a]],l;a:for(l in f){var m=z[l];if(void 0===m&&(m=z[l]=(new RegExp(l)).test(h)),m)for(var n in f[l])if(k(d,f[l][n])){e=n;break a}}e||(console.debug("No font coverage for U+"+
d.toString(16)),e="latin");B[a]=e;w[e]||I.has(e)||I.set(e,g("font-meta/"+e+".json").then(function(a){w[e]=a}));65535<d&&(a++,c=a)},c=0;c<b.length;c++)a(c);return Promise.all(I.values())}).then(function(){for(var e,f=null,g=0;g<b.length;g++){var h=b.codePointAt(g);if(f&&(d(h)||a(f).has(h)))u[g]=u[g-1];else{f=w[B[g]];var k=x[f.id];if(!k){var q=f.typeforms;k=c(q,l,"sans-serif");var t=c(q[k],m,"normal");q=null===(e=q[k])||void 0===e?void 0:e[t];var v=n,F=v;if(!q.includes(F)){F=1/0;for(var z=0;z<q.length;z++)Math.abs(q[z]-
v)<Math.abs(F-v)&&(F=q[z])}k=x[f.id]=p+"/font-files/"+f.id+"/"+k+"."+t+"."+F+".woff"}t=r.get(k);null==t&&(t=r.size,r.set(k,t));u[g]=t}65535<h&&(g++,u[g]=u[g-1])}return{fontUrls:Array.from(r.keys()),chars:u}})},Object.defineProperty(g,"__esModule",{value:!0}),g}({})}],init(g,f,k){return g(f,k())}});let Q=()=>(self.performance||Date).now(),ia=ya["default"](),ua,ha=[],ma=0,Qa=(...g)=>new Promise((f,k)=>{ha.push(()=>{const m=Q();try{ia.webgl.generateIntoCanvas(...g),f({timing:Q()-m})}catch(b){k(b)}});
ma||(ma=setTimeout(wa,0))}),xa={},Ra=0,Va=ia.webglUtils.resizeWebGLCanvasWithoutClearing,X={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:.0625,sdfExponent:9,textureWidth:2048},Sa=new B.Color,za=!1,ja=Object.create(null),ka;P=S.defineWorkerModule({name:"Typesetter",dependencies:[function(g,f){function k({text:a,lang:b,fonts:c,style:d,weight:e,preResolvedFonts:f,unicodeFontsURL:h},k){let l=({chars:a,fonts:b})=>{let c,d;const e=[];for(let f=0;f<a.length;f++)a[f]!==d?(d=a[f],e.push(c=
{start:f,end:f,fontObj:b[a[f]]})):c.end=f;k(e)};f?l(f):g(a,l,{lang:b,fonts:c,style:d,weight:e,unicodeFontsURL:h})}function m({text:g="",font:l,lang:m="en",fontSize:x=400,fontWeight:p=1,fontStyle:q="normal",letterSpacing:r=0,lineHeight:u="normal",maxWidth:t=Infinity,direction:v,textAlign:B="left",textIndent:y=0,whiteSpace:C="normal",overflowWrap:E="normal",anchorX:L=0,anchorY:J=0,metricsOnly:Y=!1,unicodeFontsURL:z,preResolvedFonts:K=null,includeCaretPositions:I=!1,chunkedBoundsSize:D=8192,colorRanges:Q=
null},X){let n=c(),w={fontLoad:0,typesetting:0};-1<g.indexOf("\r")&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),g=g.replace(/\r\n/g,"\n").replace(/\r/g,"\n"));x=+x;r=+r;t=+t;u=u||"normal";y=+y;k({text:g,lang:m,style:q,weight:p,fonts:"string"===typeof l?[{src:l}]:l,unicodeFontsURL:z,preResolvedFonts:K},k=>{w.fontLoad=c()-n;let l=isFinite(t),m=null,p=null,q=null,z=null,F=null,G=null,H=null,K=null,M=0,N=0,T="nowrap"!==C,S=new Map,aa=c(),P=y,W=0,R=new d,V=[R];k.forEach(a=>
{let {fontObj:b}=a,{ascender:c,descender:f,unitsPerEm:k,lineGap:m,capHeight:n,xHeight:p}=b,q=S.get(b);if(!q){var w=x/k;let a="normal"===u?(c-f+m)*w:u*x,d=Math.min(a,(c-f)*w);q={index:S.size,src:b.src,fontObj:b,fontSizeMult:w,unitsPerEm:k,ascender:c*w,descender:f*w,capHeight:n*w,xHeight:p*w,lineHeight:a,baseline:-((a-(c-f)*w)/2)-c*w,caretTop:(c+f)/2*w+d/2,caretBottom:(c+f)/2*w+d/2-d};S.set(b,q)}let {fontSizeMult:v}=q;w=g.slice(a.start,a.end+1);let z,F;b.forEachGlyph(w,x,r,(b,c,f)=>{c+=W;f+=a.start;
z=c;F=b;let k=g.charAt(f),m=b.advanceWidth*v;var n=R.count;"isEmpty"in b||(b.isWhitespace=!!k&&/[^\S\u00A0]/.test(k),b.canBreakAfter=!!k&&h.test(k),b.isEmpty=b.xMin===b.xMax||b.yMin===b.yMax||e.test(k));b.isWhitespace||b.isEmpty||N++;if(T&&l&&!b.isWhitespace&&c+m+P>t&&n){if(R.glyphAt(n-1).glyphObj.canBreakAfter){var p=new d;P=-c}else for(;n--;)if(0===n&&"break-word"===E){p=new d;P=-c;break}else if(R.glyphAt(n).glyphObj.canBreakAfter){p=R.splitAt(n+1);n=p.glyphAt(0).x;P-=n;for(let a=p.count;a--;)p.glyphAt(a).x-=
n;break}p&&(R.isSoftWrapped=!0,R=p,V.push(R),M=t)}p=R.glyphAt(R.count);p.glyphObj=b;p.x=c+P;p.width=m;p.charIndex=f;p.fontData=q;"\n"===k&&(R=new d,V.push(R),P=-(c+m+r*x)+y)});W=z+F.advanceWidth*v+r*x});let ba=0;V.forEach(a=>{let b=!0;for(let d=a.count;d--;){var c=a.glyphAt(d);b&&!c.glyphObj.isWhitespace&&(a.width=c.x+c.width,a.width>M&&(M=a.width),b=!1);let {lineHeight:e,capHeight:f,xHeight:g,baseline:h}=c.fontData;e>a.lineHeight&&(a.lineHeight=e);c=h-a.baseline;0>c&&(a.baseline+=c,a.cap+=c,a.ex+=
c);a.cap=Math.max(a.cap,a.baseline+f);a.ex=Math.max(a.ex,a.baseline+g)}a.baseline-=ba;a.cap-=ba;a.ex-=ba;ba+=a.lineHeight});let ea=0,ca=0;L&&("number"===typeof L?ea=-L:"string"===typeof L&&(ea=-M*("left"===L?0:"center"===L?.5:"right"===L?1:b(L))));J&&("number"===typeof J?ca=-J:"string"===typeof J&&(ca="top"===J?0:"top-baseline"===J?-V[0].baseline:"top-cap"===J?-V[0].cap:"top-ex"===J?-V[0].ex:"middle"===J?ba/2:"bottom"===J?ba:"bottom-baseline"===J?V[V.length-1].baseline:b(J)*ba));if(!Y){let b=f.getEmbeddingLevels(g,
v);m=new Uint16Array(N);p=new Uint8Array(N);q=new Float32Array(2*N);z={};H=[Infinity,Infinity,-Infinity,-Infinity];K=[];I&&(G=new Float32Array(4*g.length));Q&&(F=new Uint8Array(3*N));let c=0,d=-1,e=-1,h,l;V.forEach((k,n)=>{let {count:r,width:w}=k;if(0<r){n=0;for(var u=r;u--&&k.glyphAt(u).glyphObj.isWhitespace;)n++;var t=u=0;if("center"===B)u=(M-w)/2;else if("right"===B)u=M-w;else if("justify"===B&&k.isSoftWrapped){t=0;for(var x=r-n;x--;)k.glyphAt(x).glyphObj.isWhitespace&&t++;t=(M-w)/t}if(t||u){x=
0;for(var v=0;v<r;v++){var y=k.glyphAt(v),A=y.glyphObj;y.x+=u+x;0!==t&&A.isWhitespace&&v<r-n&&(x+=t,y.width+=t)}}u=f.getReorderSegments(g,b,k.glyphAt(0).charIndex,k.glyphAt(k.count-1).charIndex);for(t=0;t<u.length;t++){let [a,b]=u[t];x=Infinity;v=-Infinity;for(y=0;y<r;y++)if(k.glyphAt(y).charIndex>=a){for(A=y;y<r;y++){var C=k.glyphAt(y);if(C.charIndex>b)break;y<r-n&&(x=Math.min(x,C.x),v=Math.max(v,C.x+C.width))}for(;A<y;A++)C=k.glyphAt(A),C.x=v-(C.x+C.width-x);break}}let E;n=a=>E=a;for(u=0;u<r;u++){v=
k.glyphAt(u);E=v.glyphObj;t=E.index;(x=b.levels[v.charIndex]&1)&&(y=f.getMirroredCharacter(g[v.charIndex]))&&v.fontData.fontObj.forEachGlyph(y,0,0,n);if(I){let {charIndex:b,fontData:c}=v;y=v.x+ea;A=v.x+v.width+ea;G[4*b]=x?A:y;G[4*b+1]=x?y:A;G[4*b+2]=k.baseline+c.caretBottom+ca;G[4*b+3]=k.baseline+c.caretTop+ca;x=b-d;1<x&&a(G,d,x);d=b}if(Q)for({charIndex:x}=v;x>e;)e++,Q.hasOwnProperty(e)&&(l=Q[e]);if(!E.isWhitespace&&!E.isEmpty){x=c++;let {fontSizeMult:a,src:b,index:d}=v.fontData;y=z[b]||(z[b]={});
y[t]||(y[t]={path:E.path,pathBounds:[E.xMin,E.yMin,E.xMax,E.yMax]});A=v.x+ea;C=k.baseline+ca;q[2*x]=A;q[2*x+1]=C;v=A+E.xMin*a;y=C+E.yMin*a;A+=E.xMax*a;C+=E.yMax*a;v<H[0]&&(H[0]=v);y<H[1]&&(H[1]=y);A>H[2]&&(H[2]=A);C>H[3]&&(H[3]=C);0===x%D&&(h={start:x,end:x,rect:[Infinity,Infinity,-Infinity,-Infinity]},K.push(h));h.end++;let e=h.rect;v<e[0]&&(e[0]=v);y<e[1]&&(e[1]=y);A>e[2]&&(e[2]=A);C>e[3]&&(e[3]=C);m[x]=t;p[x]=d;Q&&(t=3*x,F[t]=l>>16&255,F[t+1]=l>>8&255,F[t+2]=l&255)}}}});G&&(k=g.length-d,1<k&&a(G,
d,k))}let da=[];S.forEach(({index:a,src:b,unitsPerEm:c,ascender:d,descender:e,lineHeight:f,capHeight:g,xHeight:h})=>{da[a]={src:b,unitsPerEm:c,ascender:d,descender:e,lineHeight:f,capHeight:g,xHeight:h}});w.typesetting=c()-aa;X({glyphIds:m,glyphFontIndices:p,glyphPositions:q,glyphData:z,fontData:da,caretPositions:G,glyphColors:F,chunkedBounds:K,fontSize:x,topBaseline:ca+V[0].baseline,blockBounds:[ea,ca-ba,ea+M,ca],visibleBounds:H,timings:w})})}function b(a){a=(a=a.match(/^([\d.]+)%$/))?parseFloat(a[1]):
NaN;return isNaN(a)?0:a/100}function a(a,b,c){let d=a[4*b],e=a[4*b+2],f=a[4*b+3],g=(a[4*b+1]-d)/c;for(let h=0;h<c;h++){let c=4*(b+h);a[c]=d+g*h;a[c+1]=d+g*(h+1);a[c+2]=e;a[c+3]=f}}function c(){return(self.performance||Date).now()}function d(){this.data=[]}let e=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,h=/[^\S\u00A0]|[\-\u007C\u00AD\u2010\u2012-\u2014\u2027\u2056\u2E17\u2E40]/,l=["glyphObj","x",
"width","charIndex","fontData"];d.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/l.length)},glyphAt(a){let b=d.flyweight;b.data=this.data;b.index=a;return b},splitAt(a){let b=new d;b.data=this.data.splice(a*l.length);return b}};d.flyweight=l.reduce((a,b,c,d)=>{Object.defineProperty(a,b,{get(){return this.data[this.index*l.length+c]},set(a){this.data[this.index*l.length+c]=a}});return a},{data:null,index:0});return{typeset:m,measure:function(a,
b){m({...a,metricsOnly:!0},a=>{let [c,d,e,f]=a.blockBounds;b({width:e-c,height:f-d})})}}},aa,P["default"]],init(g,f,k){return g(f,k())}});let Ua=S.defineWorkerModule({name:"Typesetter",dependencies:[P],init(g){return function(f){return new Promise(k=>{g.typeset(f,k)})}},getTransferables(g){const f=[];for(let k in g)g[k]&&g[k].buffer&&f.push(g[k].buffer);return f}}),Ea={};class Ia extends B.InstancedBufferGeometry{constructor(){super();this.detail=1;this.curveRadius=0;this.groups=[{start:0,count:Infinity,
materialIndex:0},{start:0,count:Infinity,materialIndex:1}];this.boundingSphere=new B.Sphere;this.boundingBox=new B.Box3}computeBoundingSphere(){}computeBoundingBox(){}setSide(g){let f=this.getIndex().count;this.setDrawRange(g===B.BackSide?f/2:0,g===B.DoubleSide?f:f/2)}set detail(g){if(g!==this._detail){this._detail=g;if("number"!==typeof g||1>g)g=1;let f=Wa(g);["position","normal","uv"].forEach(g=>{this.attributes[g]=f.attributes[g].clone()});this.setIndex(f.getIndex().clone())}}get detail(){return this._detail}set curveRadius(g){g!==
this._curveRadius&&(this._curveRadius=g,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(g,f,k,m,b){oa(this,"aTroikaGlyphBounds",g,4);oa(this,"aTroikaGlyphIndex",f,1);oa(this,"aTroikaGlyphColor",b,3);this._blockBounds=k;this._chunkedBounds=m;this.instanceCount=f.length;this._updateBounds()}_updateBounds(){let g=this._blockBounds;if(g){let {curveRadius:m,boundingBox:b}=this;if(m){let {PI:a,floor:c,min:d,max:e,sin:h,cos:l}=Math;var f=a/2,k=2*a;let n=Math.abs(m),F=g[0]/n,
w=g[2]/n,x=c((F+f)/k)!==c((w+f)/k)?-n:d(h(F)*n,h(w)*n);f=c((F-f)/k)!==c((w-f)/k)?n:e(h(F)*n,h(w)*n);k=c((F+a)/k)!==c((w+a)/k)?2*n:e(n-l(F)*n,n-l(w)*n);b.min.set(x,g[1],0>m?-k:0);b.max.set(f,g[3],0>m?0:k)}else b.min.set(g[0],g[1],0),b.max.set(g[2],g[3],0);b.getBoundingSphere(this.boundingSphere)}}applyClipRect(g){let f=this.getAttribute("aTroikaGlyphIndex").count,k=this._chunkedBounds;if(k)for(let m=k.length;m--;){f=k[m].end;let b=k[m].rect;if(b[1]<g.w&&b[3]>g.y&&b[0]<g.z&&b[2]>g.x)break}this.instanceCount=
f}}let qa=new B.MeshBasicMaterial({color:16777215,side:B.DoubleSide,transparent:!0}),Ja=new B.Matrix4,la=new B.Vector3,ra=new B.Vector3,da=[],Ya=new B.Vector3,Ka=()=>{let g=new B.Mesh(new B.PlaneGeometry(1,1),qa);Ka=()=>g;return g},La=()=>{let g=new B.Mesh(new B.PlaneGeometry(1,1,32,1),qa);La=()=>g;return g},Za={type:"syncstart"},$a={type:"synccomplete"},Ma="font fontSize fontStyle fontWeight lang letterSpacing lineHeight maxWidth overflowWrap text direction textAlign textIndent whiteSpace anchorX anchorY colorRanges sdfGlyphSize".split(" "),
ab=Ma.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class Na extends B.Mesh{constructor(){super(new Ia,null);this.text="";this.curveRadius=this.anchorY=this.anchorX=0;this.direction="auto";this.unicodeFontsURL=this.font=null;this.fontSize=.1;this.fontStyle=this.fontWeight="normal";this.lang="en";this.letterSpacing=0;this.lineHeight="normal";this.maxWidth=Infinity;this.overflowWrap="normal";this.textAlign="left";this.textIndent=0;this.whiteSpace=
"normal";this.colorRanges=this.color=this.material=null;this.outlineColor=this.outlineWidth=0;this.outlineOpacity=1;this.strokeWidth=this.outlineOffsetY=this.outlineOffsetX=this.outlineBlur=0;this.strokeColor=8421504;this.fillOpacity=this.strokeOpacity=1;this.depthOffset=0;this.clipRect=null;this.orientation="+x+y";this.glyphGeometryDetail=1;this.sdfGlyphSize=null;this.gpuAccelerateSDF=!0;this.debugSDF=!1}sync(g){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=
[])).push(g):(this._isSyncing=!0,this.dispatchEvent(Za),na({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,
includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},f=>{this._isSyncing=!1;this._textRenderInfo=f;this.geometry.updateGlyphs(f.glyphBounds,f.glyphAtlasIndices,f.blockBounds,f.chunkedBounds,f.glyphColors);let k=this._queuedSyncs;k&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{k.forEach(f=>f&&f())}));this.dispatchEvent($a);g&&g()})))}onBeforeRender(g,f,k,m,b,a){this.sync();b.isTroikaTextMaterial&&this._prepareForRender(b);
b._hadOwnSide=b.hasOwnProperty("side");this.geometry.setSide(b._actualSide=b.side);b.side=B.FrontSide}onAfterRender(g,f,k,m,b,a){b._hadOwnSide?b.side=b._actualSide:delete b.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let g=this._derivedMaterial,f=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=qa.clone());g&&g.baseMaterial===f||(g=this._derivedMaterial=Fa(f),f.addEventListener("dispose",function m(){f.removeEventListener("dispose",
m);g.dispose()}));if(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let f=g._outlineMtl;f||(f=g._outlineMtl=Object.create(g,{id:{value:g.id+.1}}),f.isTextOutlineMaterial=!0,f.depthWrite=!1,f.map=null,g.addEventListener("dispose",function b(){g.removeEventListener("dispose",b);f.dispose()}));return[f,g]}return g}set material(g){g&&g.isTroikaTextMaterial?(this._derivedMaterial=g,this._baseMaterial=g.baseMaterial):this._baseMaterial=g}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(g){this.geometry.detail=
g}get curveRadius(){return this.geometry.curveRadius}set curveRadius(g){this.geometry.curveRadius=g}get customDepthMaterial(){return Ga(this.material).getDepthMaterial()}get customDistanceMaterial(){return Ga(this.material).getDistanceMaterial()}_prepareForRender(g){var f=g.isTextOutlineMaterial,k=g.uniforms,m=this.textRenderInfo;if(m){let {sdfTexture:a,blockBounds:c}=m;k.uTroikaSDFTexture.value=a;k.uTroikaSDFTextureSize.value.set(a.image.width,a.image.height);k.uTroikaSDFGlyphSize.value=m.sdfGlyphSize;
k.uTroikaSDFExponent.value=m.sdfExponent;k.uTroikaTotalBounds.value.fromArray(c);k.uTroikaUseGlyphColors.value=!f&&!!m.glyphColors;let d=m=0,e=0,g;let l=0,n=0;if(f){let {outlineWidth:a,outlineOffsetX:b,outlineOffsetY:c,outlineBlur:e,outlineOpacity:f}=this;m=this._parsePercent(a)||0;d=Math.max(0,this._parsePercent(e)||0);g=f;l=this._parsePercent(b)||0;n=this._parsePercent(c)||0}else{if(e=Math.max(0,this._parsePercent(this.strokeWidth)||0)){var b=this.strokeColor;k.uTroikaStrokeColor.value.set(null==
b?8421504:b);b=this.strokeOpacity;null==b&&(b=1)}g=this.fillOpacity}k.uTroikaDistanceOffset.value=m;k.uTroikaPositionOffset.value.set(l,n);k.uTroikaBlurRadius.value=d;k.uTroikaStrokeWidth.value=e;k.uTroikaStrokeOpacity.value=b;k.uTroikaFillOpacity.value=null==g?1:g;k.uTroikaCurveRadius.value=this.curveRadius||0;(m=this.clipRect)&&Array.isArray(m)&&4===m.length?k.uTroikaClipRect.value.fromArray(m):(m=100*(this.fontSize||.1),k.uTroikaClipRect.value.set(c[0]-m,c[1]-m,c[2]+m,c[3]+m));this.geometry.applyClipRect(k.uTroikaClipRect.value)}k.uTroikaSDFDebug.value=
!!this.debugSDF;g.polygonOffset=!!this.depthOffset;g.polygonOffsetFactor=g.polygonOffsetUnits=this.depthOffset||0;f=f?this.outlineColor||0:this.color;null==f?delete g.color:(m=g.hasOwnProperty("color")?g.color:g.color=new B.Color,(f!==m._input||"object"===typeof f)&&m.set(m._input=f));f=this.orientation||"+x+y";if(f!==g._orientation){k=k.uTroikaOrient.value;f=f.replace(/[^-+xyz]/g,"");if(m="+x+y"!==f&&f.match(/^([-+])([xyz])([-+])([xyz])$/)){let [,a,b,d,e]=m;la.set(0,0,0)[b]="-"===a?1:-1;ra.set(0,
0,0)[e]="-"===d?-1:1;Ja.lookAt(Ya,la.cross(ra),ra);k.setFromMatrix4(Ja)}else k.identity();g._orientation=f}}_parsePercent(g){"string"===typeof g&&(g=(g=g.match(/^(-?[\d.]+)%$/))?parseFloat(g[1]):NaN,g=(isNaN(g)?0:g/100)*this.fontSize);return g}localPositionToTextCoords(g,f=new B.Vector2){f.copy(g);let k=this.curveRadius;k&&(f.x=Math.atan2(g.x,Math.abs(k)-Math.abs(g.z))*Math.abs(k));return f}worldPositionToTextCoords(g,f=new B.Vector2){la.copy(g);return this.localPositionToTextCoords(this.worldToLocal(la),
f)}raycast(g,f){let {textRenderInfo:k,curveRadius:m}=this;if(k){let b=k.blockBounds,a=m?La():Ka(),c=a.geometry,{position:d,uv:e}=c.attributes;for(let a=0;a<e.count;a++){let c=b[0]+e.getX(a)*(b[2]-b[0]),f=b[1]+e.getY(a)*(b[3]-b[1]),g=0;m&&(g=m-Math.cos(c/m)*m,c=Math.sin(c/m)*m);d.setXYZ(a,c,f,g)}c.boundingSphere=this.geometry.boundingSphere;c.boundingBox=this.geometry.boundingBox;a.matrixWorld=this.matrixWorld;a.material.side=this.material.side;da.length=0;a.raycast(g,da);for(g=0;g<da.length;g++)da[g].object=
this,f.push(da[g])}}copy(g){let f=this.geometry;super.copy(g);this.geometry=f;ab.forEach(f=>{this[f]=g[f]});return this}clone(){return(new this.constructor).copy(this)}}Ma.forEach(g=>{let f="_private_"+g;Object.defineProperty(Na.prototype,g,{get(){return this[f]},set(g){g!==this[f]&&(this[f]=g,this._needsSync=!0)}})});let Oa=new WeakMap,Ha=new WeakMap;E.GlyphsGeometry=Ia;E.Text=Na;E.configureTextBuilder=function(g){za?console.warn("configureTextBuilder called after first font request; will be ignored."):
Aa(X,g)};E.createTextDerivedMaterial=Fa;E.dumpSDFTextures=function(){Object.keys(ja).forEach(g=>{g=ja[g].sdfCanvas;let {width:f,height:k}=g;console.log("%c.",`
      background: url(${g.toDataURL()});
      background-size: ${f}px ${k}px;
      color: transparent;
      font-size: 0;
      line-height: ${k}px;
      padding-left: ${f}px;
    `)})};E.fontResolverWorkerModule=aa;E.getCaretAtPoint=function(g,f,k){let m=null,b=null;Xa(g).forEach(a=>{if(!b||Math.abs(k-(a.top+a.bottom)/2)<Math.abs(k-(b.top+b.bottom)/2))b=a});b.carets.forEach(a=>{if(!m||Math.abs(f-a.x)<Math.abs(f-m.x))m=a});return m};E.getSelectionRects=function(g,f,k){var m;if(g){if((m=Oa.get(g))&&m.start===f&&m.end===k)return m.rects;var {caretPositions:b}=g;k<f&&(m=f,f=k,k=m);f=Math.max(f,0);k=Math.min(k,b.length+1);m=[];var a=null;for(var c=f;c<k;c++){var d=b[4*c],e=
b[4*c+1];let f=Math.min(d,e);d=Math.max(d,e);e=b[4*c+2];let g=b[4*c+3];if(!a||e!==a.bottom||g!==a.top||f>a.right||d<a.left)a={left:Infinity,right:-Infinity,bottom:e,top:g},m.push(a);a.left=Math.min(f,a.left);a.right=Math.max(d,a.right)}m.sort((a,b)=>b.bottom-a.bottom||a.left-b.left);for(b=m.length-1;0<b--;)a=m[b],c=m[b+1],a.bottom===c.bottom&&a.top===c.top&&a.left<=c.right&&a.right>=c.left&&(c.left=Math.min(c.left,a.left),c.right=Math.max(c.right,a.right),m.splice(b,1));Oa.set(g,{start:f,end:k,rects:m})}return m};
E.getTextRenderInfo=na;E.preloadFont=function({font:g,characters:f,sdfGlyphSize:k},m){f=Array.isArray(f)?f.join("\n"):""+f;na({font:g,sdfGlyphSize:k,text:f},m)};E.typesetterWorkerModule=P;Object.defineProperty(E,"__esModule",{value:!0})})
